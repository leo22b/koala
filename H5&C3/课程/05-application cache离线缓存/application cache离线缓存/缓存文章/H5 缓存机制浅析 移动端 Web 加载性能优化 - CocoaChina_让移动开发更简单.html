<!DOCTYPE html>
<!-- saved from url=(0052)http://www.cocoachina.com/webapp/20151217/14718.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    

    <title>H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单</title>
    <meta name="keywords" content="HTML5iPhone开发,iOS开发,iPad开发,Mac开发,苹果开发中文站,iPhone开发中文站,CocoaChina首页, Mac OS开发, Cocoa介绍,移动互联网,触控科技,Cocoa,Apple,developer,iOS,iPhone,iPad,iMac,iPod Touch,iPhone5,iPhone4S,iPad3,招聘,iPhone程序员,Objective-c,iPhone应用外包,ios6,ios面试,Cocos2d-x,cocos2d,iTunes,App Store,苹果开发">
    <meta name="description" content="CocoaChina前身是全球成立最早规模最大的苹果开发中文站，现致力为所有移动开发者提供资讯服务、问答服务、代码下载、工具库及人才招聘服务">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="baidu-tc-cerfication" content="3300a939a1098c27e94457b75a0bb8c1">
    <script type="text/javascript" async="" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/ga.js.下载"></script><script src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/hm.js.下载"></script><script type="text/javascript" async="" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/ga.js.下载"></script><script async="" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/analytics.js.下载"></script><script type="text/javascript">
        function gotoMobilePage() {
            var sUserAgent = navigator.userAgent.toLowerCase();
            var agent_iphone = /iphone/i;
            var agent_android = /android/i;
            //var agent_ipad = /ipad/i;
            var agent_ipod = /ipod/i;
            var agent_wphone = /windows phone/i;
            if(agent_iphone.test(sUserAgent) || agent_android.test(sUserAgent) || agent_ipod.test(sUserAgent) || agent_wphone.test(sUserAgent)){
                var re = /\/\w+\/\d+\/(\d+)\.html/, 
                    result = re.exec(window.location.pathname);
                if ( result )
                {
                    window.location.href = "http://www.cocoachina.com/cms/wap.php?action=article&id=" + result[1];
                } else {
                    window.location.href = "http://m.cocoachina.com/";
                }
            }
        }
        gotoMobilePage(); 
    </script>
    <link rel="stylesheet" href="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/global.css" media="all">
    <link rel="stylesheet" href="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/index.css" media="all">
    <link href="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/module.css" rel="stylesheet">
    <link href="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/style.css" rel="stylesheet">
    <link href="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/navheader.css" rel="stylesheet">
    <script src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/jquery.min.js.下载" type="text/javascript"></script>
    <script type="text/javascript" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/navbar.js.下载"></script>
    <script type="text/javascript" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/k.js.下载"></script>
    
<script src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/share.js.下载"></script><link rel="stylesheet" href="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/share_style1_32.css"></head>
<body>

    <div class="nav-header">
            <div class="nav-header-top">
                <div class="nav-logo nav-fl"><a href="http://www.cocoachina.com/"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/logo.png"></a></div>
                <div class="nav-list nav-fl">
                    <ul>
                        <li><a href="http://www.cocoachina.com/news/">资讯</a></li>
                        <li><a href="http://www.cocoachina.com/bbs/">论坛</a></li>
                        <li><a target="_blank" href="http://code.cocoachina.com/" title="CODE">代码</a></li>
                        <li><a href="http://tools.cocoachina.com/" title="工具" target="_blank">工具</a></li>
                        <li><a target="_blank" href="http://job.cocoachina.com/" title="JOB">招聘</a></li>
                        <li><a target="_blank" href="http://cvp.cocos.com/" title="CVP">CVP</a></li>
                        <li><a target="_blank" href="http://waikuai.cocoachina.com/" title="waikuai">外快</a></li>
                        <li><a target="_blank" href="http://blog.cocoachina.com/" title="blog">博客</a><span class="new-item-flag">new</span></li>
                    </ul>
                </div>
                <div class="nav-search nav-fl">
                    <div class="nav-search-flag" style="display:block"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/search-icon.png"></div>
                    <div class="nav-search-form" style="display:none">
                        <form action="http://www.cocoachina.com/cms/plus/search.php" name="formsearch" method="post" target="_blank">
                            <input type="hidden" name="kwtype" value="0">
                            <input type="hidden" name="searchtype" value="titlekeyword">
                            <input name="keyword" type="text" placeholder="站内搜索">
                            <input type="button">
                        </form>
                    </div>
                </div>
                <div class="nav-user nav-fr">
                    <!-- #region 未登录时显示此区域 -->
                    <div class="nav-user-login" style="display:block">
                        <a href="http://www.cocoachina.com/bbs/login.php">登录</a>|
                        <a href="http://www.cocoachina.com/bbs/register.php">注册</a>
                    </div>
                    <!-- #endregion -->
                    <!-- #region 已登录时显示此区域 -->
                    <div class="nav-user-name" style="display:none">
                        <div><alert></alert><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/user.png">Guest</div>
                        <ul>
                            <li><a href="http://www.cocoachina.com/webapp/20151217/14718.html#"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/i-man.png">我的主页</a></li>
                            <li><alert></alert><a href="http://www.cocoachina.com/webapp/20151217/14718.html#"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/i-mail.png">我的消息</a></li>
                            <li><a href="http://www.cocoachina.com/webapp/20151217/14718.html#"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/i-setting.png">账户设置</a></li>
                            <li><a href="http://www.cocoachina.com/webapp/20151217/index-offline.html"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/i-logout.png">退出</a></li>
                        </ul>
                    </div>
                    <!-- #endregion -->
                </div>
                <div class="nav-clear"></div>
            </div>
        <div class="nav-header-bottom">
            <ul>
                <li><a id="ios" href="http://www.cocoachina.com/ios/" title="ios">iOS开发</a></li>
                <li><a id="swift" href="http://www.cocoachina.com/swift/" title="swift">Swift</a></li>
                <li><a id="app_store" href="http://www.cocoachina.com/appstore/" title="appstore">App Store研究</a></li>
                <li><a id="design" href="http://www.cocoachina.com/design/" title="design">产品设计</a></li>
                <li><a id="review" href="http://www.cocoachina.com/review/" title="review">应用</a></li>
                <li><a id="review" href="http://www.cocoachina.com/vr/" title="review">VR</a></li>
                <li><a id="game" href="http://www.cocoachina.com/game/" title="game">游戏开发</a></li>
                <li><a id="apple" href="http://www.cocoachina.com/apple/" title="apple">苹果相关</a></li>
                <!-- <li><a id="cocos" href="/cocos/" title="cocos">Cocos引擎</a></li>-->
                <!--<li><a id="webapp" href="/webapp/" title="HTML5">HTML5</a></li>-->
                <li><a id="android" href="http://www.cocoachina.com/android/" title="android">安卓相关</a></li>
                <li><a id="market" href="http://www.cocoachina.com/market/" title="market">营销推广</a></li>
                <li><a id="industry" href="http://www.cocoachina.com/industry/" title="industry">业界动态</a></li>
                <li><a id="programmer" href="http://www.cocoachina.com/programmer/" title="programmer">程序人生</a></li>
            </ul>
        </div>
    </div>

<script language="javascript">
    function IsPC() {
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPod");
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
        if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
        }
        return flag;
    }
    if (!IsPC()){
           window.location.href = "http://www.cocoachina.com/cms/wap.php?action=article&id=14718";
    }

</script>
<!--middle-->
<div class="middle clearfix">
    <div class="m-wrap">
        <div class="m-ad2" style="margin-top:12px;">
            <div class="ad2-l">
                <script async="" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/adsbygoogle.js.下载"></script>
                <!-- CC首页底部左侧72890 -->
                <ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-1180518835303646" data-ad-slot="8012423965"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            <div class="ad2-r">
                <script async="" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/adsbygoogle.js.下载"></script>
                <!-- CC资讯页25090 -->
                <ins class="adsbygoogle" style="display:inline-block;width:250px;height:90px" data-ad-client="ca-pub-1180518835303646" data-ad-slot="9489157162"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>
        <!--left-->
        <div class="detail-left float-l">
            <p class="crumbs"><a href="http://www.cocoachina.com/" title="首页">首页</a> &gt;<a href="http://www.cocoachina.com/webapp" title="HTML5"><span id="type_name">HTML5</span></a></p>
            <div class="detail-main">
                <h2>H5 缓存机制浅析 移动端 Web 加载性能优化</h2>
                <div class="p-ico clearfix">
                    <div>
                        <span class="ml0">2015-12-17 10:17</span>
                        <span>编辑：
                        <a href="http://www.cocoachina.com/webapp/20151217/14718.html" id="field_author" target="_blank">yunpeng.hu</a></span>
                        <span>分类：<a href="http://www.cocoachina.com/webapp/" target="_blank">HTML5</a></span>
                        <span id="source">来源：<a href="http://segmentfault.com/a/1190000004132566" target="_blank">segmentfault</a></span>

                        <div class="float-r">
                            <span id="artical_comment_cnt"><i></i>1</span>
                            <span><i class="view"></i><script src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/count.php" language="javascript"></script>21692</span>
                    </div>
                    </div>
                </div>
                <div class="p-ico clearfix">
                    <p class="related float-l"><a href="http://www.cocoachina.com/cms/tags.php?/Html5/" target="_blank">Html5</a></p>
                    <input type="hidden" id="article_id" value="14718">
                </div>
                <div class="adsbox clearfix">
                    <div class="float-l">
                        <div class="float-l"><b>招聘信息：</b></div>
                        <ul class="float-l" id="invitelist" style="margin-top: -7.98741px;"><li><a href="http://job.cocoachina.com/job/show?id=68415" target="_blank">Java工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=68414" target="_blank">Cocos2d-x js高级开发工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=68283" target="_blank">Mac开发</a></li><li><a href="http://job.cocoachina.com/job/show?id=68066" target="_blank">应用开发工程师(iOS)</a></li><li><a href="http://job.cocoachina.com/job/show?id=68363" target="_blank">技术合伙人-后端工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=67931" target="_blank">高级iOS开发工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=68061" target="_blank">资深软件研发工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=67960" target="_blank">嵌入式软件工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=68369" target="_blank">产品经理</a></li><li><a href="http://job.cocoachina.com/job/show?id=68365" target="_blank">cocos2d-x休闲游戏开发</a></li><li><a href="http://job.cocoachina.com/job/show?id=68442" target="_blank">Cocos2d-x游戏客户端开发</a></li></ul>
                    </div>
                    <div class="float-r">
                        <a href="javascript:void(0)" class="prev"></a>
                        <a href="javascript:void(0)" class="next"></a>
                    </div>
                </div>
                <div id="detailbody" class="field_body">
                    <p><strong><span style="font-size: 18px;">1 H5 缓存机制介绍</span></strong></p><p>H5，即 HTML5，是新一代的 HTML 标准，加入很多新的特性。离线存储（也可称为缓存机制）是其中一个非常重要的特性。H5 引入的离线存储，这意味着 web 应用可进行缓存，并可在没有因特网连接时进行访问。</p><p>H5 应用程序缓存为应用带来三个优势：</p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p>离线浏览 用户可在应用离线时使用它们</p></li><li><p>速度 已缓存资源加载得更快</p></li><li><p>减少服务器负载 浏览器将只从服务器下载更新过或更改过的资源。</p></li></ul><p>根据标准，到目前为止，H5 一共有6种缓存机制，有些是之前已有，有些是 H5 才新加入的。</p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p>浏览器缓存机制</p></li><li><p>Dom Storgage（Web Storage）存储机制</p></li><li><p>Web SQL Database 存储机制</p></li><li><p>Application Cache（AppCache）机制</p></li><li><p>Indexed Database （IndexedDB）</p></li><li><p>File System API</p></li></ol><p>下面我们首先分析各种缓存机制的原理、用法及特点；然后针对 Anroid 移动端 Web 性能加载优化的需求，看如果利用适当缓存机制来提高 Web 的加载性能。</p><p><span style="font-size: 18px;"><strong>2 H5 缓存机制原理分析</strong></span></p><p><span style="font-size: 16px;"><strong>2.1 浏览器缓存机制</strong></span></p><p>浏览器缓存机制是指通过 HTTP 协议头里的 Cache-Control（或 Expires）和 Last-Modified（或 Etag）等字段来控制文件缓存的机制。这应该是 WEB 中最早的缓存机制了，是在 HTTP 协议中实现的，有点不同于 Dom Storage、AppCache 等缓存机制，但本质上是一样的。可以理解为，一个是协议层实现的，一个是应用层实现的。</p><p>Cache-Control 用于控制文件在本地缓存有效时长。最常见的，比如服务器回包：Cache-Control:max-age=600 表示文件在本地应该缓存，且有效时长是600秒（从发出请求算起）。在接下来600秒内，如果有请求这个资源，浏览器不会发出 HTTP 请求，而是直接使用本地缓存的文件。</p><p>Last-Modified 是标识文件在服务器上的最新更新时间。下次请求时，如果文件缓存过期，浏览器通过 If-Modified-Since 字段带上这个时间，发送给服务器，由服务器比较时间戳来判断文件是否有修改。如果没有修改，服务器返回304告诉浏览器继续使用缓存；如果有修改，则返回200，同时返回最新的文件。</p><p>Cache-Control 通常与 Last-Modified 一起使用。一个用于控制缓存有效时间，一个在缓存失效后，向服务查询是否有更新。</p><p>Cache-Control 还有一个同功能的字段：Expires。Expires 的值一个绝对的时间点，如：Expires: Thu, 10 Nov 2015 08:45:11 GMT，表示在这个时间点之前，缓存都是有效的。</p><p>Expires 是 HTTP1.0 标准中的字段，Cache-Control 是 HTTP1.1 标准中新加的字段，功能一样，都是控制缓存的有效时间。当这两个字段同时出现时，Cache-Control 是高优化级的。</p><p>Etag 也是和 Last-Modified 一样，对文件进行标识的字段。不同的是，Etag 的取值是一个对文件进行标识的特征字串。在向服务器查询文件是否有更新时，浏览器通过 If-None-Match 字段把特征字串发送给服务器，由服务器和文件最新特征字串进行匹配，来判断文件是否有更新。没有更新回包304，有更新回包200。Etag 和 Last-Modified 可根据需求使用一个或两个同时使用。两个同时使用时，只要满足基中一个条件，就认为文件没有更新。</p><p>另外有两种特殊的情况：</p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p>手动刷新页面（F5)，浏览器会直接认为缓存已经过期（可能缓存还没有过期），在请求中加上字段：Cache-Control:max-age=0，发包向服务器查询是否有文件是否有更新。</p></li><li><p>强制刷新页面（Ctrl+F5)，浏览器会直接忽略本地的缓存（有缓存也会认为本地没有缓存），在请求中加上字段：Cache-Control:no-cache（或 Pragma:no-cache），发包向服务重新拉取文件。</p></li></ul><p>下面是通过 Google Chrome 浏览器（用其他浏览器+抓包工具也可以）自带的开发者工具，对一个资源文件不同情况请求与回包的截图。</p><p>首次请求：200<br></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450236451436186.gif" title="1450236451436186.gif" alt="Vh8bpPi.gif" style="width: 397px; height: 221px;"></p><p>缓存有效期内请求：200(from cache)</p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450236507339553.gif" title="1450236507339553.gif" alt="q36bsW4.gif" style="width: 402px; height: 190px;"></p><p>缓存过期后请求：304（Not Modified)</p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450236583481684.gif" title="1450236583481684.gif" alt="xKsdLUS.gif" style="width: 400px; height: 240px;"></p><p>一般浏览器会将缓存记录及缓存文件存在本地 Cache 文件夹中。Android 下 App 如果使用 Webview，缓存的文件记录及文件内容会存在当前 app 的 data 目录中。</p><p>分析：Cache-Control 和 Last-Modified 一般用在 Web 的静态资源文件上，如 JS、CSS 和一些图像文件。通过设置资源文件缓存属性，对提高资源文件加载速度，节省流量很有意义，特别是移动网络环境。但问题是：缓存有效时长该如何设置？如果设置太短，就起不到缓存的使用；如果设置的太长，在资源文件有更新时，浏览器如果有缓存，则不能及时取到最新的文件。</p><p>Last-Modified 需要向服务器发起查询请求，才能知道资源文件有没有更新。虽然服务器可能返回304告诉没有更新，但也还有一个请求的过程。对于移动网络，这个请求可能是比较耗时的。有一种说法叫“消灭304”，指的就是优化掉304的请求。</p><p>抓包发现，带 if-Modified-Since 字段的请求，如果服务器回包304，回包带有 Cache-Control:max-age 或 Expires 字段，文件的缓存有效时间会更新，就是文件的缓存会重新有效。304回包后如果再请求，则又直接使用缓存文件了，不再向服务器查询文件是否更新了，除非新的缓存时间再次过期。</p><p>另外，Cache-Control 与 Last-Modified 是浏览器内核的机制，一般都是标准的实现，不能更改或设置。以 QQ 浏览器的 X5为例，Cache-Control 与 Last-Modified 缓存不能禁用。缓存容量是12MB，不分HOST，过期的缓存会最先被清除。如果都没过期，应该优先清最早的缓存或最快到期的或文件大小最大的；过期缓存也有可能还是有效的，清除缓存会导致资源文件的重新拉取。</p><p>还有，浏览器，如 X5，在使用缓存文件时，是没有对缓存文件内容进行校验的，这样缓存文件内容被修改的可能。</p><p>分析发现，浏览器的缓存机制还不是非常完美的缓存机制。完美的缓存机制应该是这样的：</p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p>缓存文件没更新，尽可能使用缓存，不用和服务器交互；</p></li><li><p>缓存文件有更新时，第一时间能使用到新的文件；</p></li><li><p>缓存的文件要保持完整性，不使用被修改过的缓存文件；</p></li><li><p>缓存的容量大小要能设置或控制，缓存文件不能因为存储空间限制或过期被清除。</p><p>以X5为例，第1、2条不能同时满足，第3、4条都不能满足。</p></li></ol><p>在实际应用中，为了解决 Cache-Control 缓存时长不好设置的问题，以及为了”消灭304“，Web前端采用的方式是：</p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p>在要缓存的资源文件名中加上版本号或文件 MD5值字串，如 common.d5d02a02.js，common.v1.js，同时设置 Cache-Control:max-age=31536000，也就是一年。在一年时间内，资源文件如果本地有缓存，就会使用缓存；也就不会有304的回包。</p></li><li><p>如果资源文件有修改，则更新文件内容，同时修改资源文件名，如 common.v2.js，html页面也会引用新的资源文件名。</p></li></ol><p>通过这种方式，实现了：缓存文件没有更新，则使用缓存；缓存文件有更新，则第一时间使用最新文件的目的。即上面说的第1、2条。第3、4条由于浏览器内部机制，目前还无法满足。</p><p><span style="font-size: 16px;"><strong>2.2 Dom Storage 存储机制</strong></span></p><p>DOM 存储是一套在 Web Applications 1.0 规范中首次引入的与存储相关的特性的总称，现在已经分离出来，单独发展成为独立的 W3C Web 存储规范。 DOM 存储被设计为用来提供一个更大存储量、更安全、更便捷的存储方法，从而可以代替掉将一些不需要让服务器知道的信息存储到 cookies 里的这种传统方法。</p><p>上面一段是对 Dom Storage 存储机制的官方表述。看起来，Dom Storage 机制类似 Cookies，但有一些优势。</p><p>Dom Storage 是通过存储字符串的 Key/Value 对来提供的，并提供 5MB （不同浏览器可能不同，分 HOST)的存储空间（Cookies 才 4KB)。另外 Dom Storage 存储的数据在本地，不像 Cookies，每次请求一次页面，Cookies 都会发送给服务器。</p><p>DOM Storage 分为 sessionStorage 和 localStorage。localStorage 对象和 sessionStorage 对象使用方法基本相同，它们的区别在于作用的范围不同。sessionStorage 用来存储与页面相关的数据，它在页面关闭后无法使用。而 localStorage 则持久存在，在页面关闭后也可以使用。</p><p>Dom Storage 提供了以下的存储接口：</p><div><div id="highlighter_359203" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">interface&nbsp;Storage&nbsp;{&nbsp;</code></div><div class="line number2 index1 alt1"><code class="js plain">readonly&nbsp;attribute&nbsp;unsigned&nbsp;long&nbsp;length;&nbsp;</code></div><div class="line number3 index2 alt2"><code class="js plain">[IndexGetter]&nbsp;DOMString&nbsp;key(</code><code class="js keyword">in</code>&nbsp;<code class="js plain">unsigned&nbsp;long&nbsp;index);&nbsp;</code></div><div class="line number4 index3 alt1"><code class="js plain">[NameGetter]&nbsp;DOMString&nbsp;getItem(</code><code class="js keyword">in</code>&nbsp;<code class="js plain">DOMString&nbsp;key);&nbsp;</code></div><div class="line number5 index4 alt2"><code class="js plain">[NameSetter]&nbsp;void&nbsp;setItem(</code><code class="js keyword">in</code>&nbsp;<code class="js plain">DOMString&nbsp;key,&nbsp;</code><code class="js keyword">in</code>&nbsp;<code class="js plain">DOMString&nbsp;data);&nbsp;</code></div><div class="line number6 index5 alt1"><code class="js plain">[NameDeleter]&nbsp;void&nbsp;removeItem(</code><code class="js keyword">in</code>&nbsp;<code class="js plain">DOMString&nbsp;key);&nbsp;</code></div><div class="line number7 index6 alt2"><code class="js plain">void&nbsp;clear();</code></div><div class="line number8 index7 alt1"><code class="js plain">};</code></div></div></td></tr></tbody></table></div></div><p>sessionStorage 是个全局对象，它维护着在页面会话(page session)期间有效的存储空间。只要浏览器开着，页面会话周期就会一直持续。当页面重新载入(reload)或者被恢复(restores)时，页面会话也是一直存在的。每在新标签或者新窗口中打开一个新页面，都会初始化一个新的会话。</p><div><div id="highlighter_282244" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js spaces">&nbsp;</code><code class="js comments">//&nbsp;当页面刷新时，从sessionStorage恢复之前输入的内容</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;</code><code class="js plain">window.onload&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(){</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code>&nbsp;<code class="js plain">(window.sessionStorage)&nbsp;{</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">name&nbsp;=&nbsp;window.sessionStorage.getItem(</code><code class="js string">"name"</code><code class="js plain">);</code></div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code>&nbsp;<code class="js plain">(name&nbsp;!=&nbsp;</code><code class="js string">""</code>&nbsp;<code class="js plain">||&nbsp;name&nbsp;!=&nbsp;</code><code class="js keyword">null</code><code class="js plain">){</code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.getElementById(</code><code class="js string">"name"</code><code class="js plain">).value&nbsp;=&nbsp;name;</code></div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number9 index8 alt2"><code class="js spaces">&nbsp;</code><code class="js plain">};</code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;</code><code class="js comments">//&nbsp;将数据保存到sessionStorage对象中</code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;</code><code class="js keyword">function</code>&nbsp;<code class="js plain">saveToStorage()&nbsp;{</code></div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code>&nbsp;<code class="js plain">(window.sessionStorage)&nbsp;{</code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">name&nbsp;=&nbsp;document.getElementById(</code><code class="js string">"name"</code><code class="js plain">).value;</code></div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">window.sessionStorage.setItem(</code><code class="js string">"name"</code><code class="js plain">,&nbsp;name);</code></div><div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">window.location.href=</code><code class="js string">"session_storage.html"</code><code class="js plain">;</code></div><div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number17 index16 alt2"><code class="js spaces">&nbsp;</code><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div><p>当浏览器被意外刷新的时候，一些临时数据应当被保存和恢复。sessionStorage 对象在处理这种情况的时候是最有用的。比如恢复我们在表单中已经填写的数据。</p><p>把上面的代码复制到 session_storage.html（也可以从附件中直接下载）页面中，用 Google Chrome 浏览器的不同 PAGE 或 WINDOW 打开，在输入框中分别输入不同的文字，再点击“Save”，然后分别刷新。每个 PAGE 或 WINDOW 显示都是当前PAGE输入的内容，互不影响。关闭 PAGE，再重新打开，上一次输入保存的内容已经没有了。<br></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450236859238383.gif" title="1450236859238383.gif" alt="F3p7KoF.gif" style="width: 378px; height: 92px;"></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450236905570329.gif" title="1450236905570329.gif" alt="FTSyNzK.gif" style="line-height: 1.8; width: 374px; height: 79px;"></p><p>Local Storage 的接口、用法与 Session Storage 一样，唯一不同的是：Local Storage 保存的数据是持久性的。当前 PAGE 关闭（Page Session 结束后），保存的数据依然存在。重新打开PAGE，上次保存的数据可以获取到。另外，Local Storage 是全局性的，同时打开两个 PAGE 会共享一份存数据，在一个PAGE中修改数据，另一个 PAGE 中是可以感知到的。</p><div><div id="highlighter_434532" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//通过localStorage直接引用key,&nbsp;另一种写法，等价于：</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//localStorage.getItem("pageLoadCount");</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//localStorage.setItem("pageLoadCount",&nbsp;value);</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">if</code>&nbsp;<code class="js plain">(!localStorage.pageLoadCount)</code></div><div class="line number5 index4 alt2"><code class="js plain">localStorage.pageLoadCount&nbsp;=&nbsp;0;</code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">localStorage.pageLoadCount&nbsp;=&nbsp;parseInt(localStorage.pageLoadCount)&nbsp;+&nbsp;1;</code></div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.getElementById(</code><code class="js string">'count'</code><code class="js plain">).textContent&nbsp;=&nbsp;localStorage.pageLoadCount;&nbsp;&nbsp;&nbsp;&nbsp;You&nbsp;have&nbsp;viewed&nbsp;</code><code class="js keyword">this</code>&nbsp;<code class="js plain">page</code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">an&nbsp;untold&nbsp;number&nbsp;of&nbsp;&nbsp;&nbsp;&nbsp;time(s).</code></div></div></td></tr></tbody></table></div></div><p>将上面代码复制到 local_storage.html 的页面中，用浏览器打开，pageLoadCount 的值是1；关闭 PAGE 重新打开，pageLoadCount 的值是2。这是因为第一次的值已经保存了。<br></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450237094647954.gif" title="1450237094647954.gif" alt="gX0nhDe.gif" style="width: 380px; height: 91px;"></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450237155229066.gif" title="1450237155229066.gif" alt="VsSJUCN.gif" style="width: 383px; height: 89px;"></p><p>用两个 PAGE 同时打开 local_storage.html，并分别交替刷新，发现两个 PAGE 是共享一个 pageLoadCount 的。<br></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450237242510533.gif" title="1450237242510533.gif" alt="K3d9gc0.gif" style="width: 382px; height: 87px;"></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450237293432584.gif" title="1450237293432584.gif" alt="cWePbMp.gif" style="width: 383px; height: 93px;"></p><p>分析：Dom Storage 给 Web 提供了一种更录活的数据存储方式，存储空间更大（相对 Cookies)，用法也比较简单，方便存储服务器或本地的一些临时数据。<br></p><p>从 DomStorage 提供的接口来看，DomStorage 适合存储比较简单的数据，如果要存储结构化的数据，可能要借助 JASON了，将要存储的对象转为 JASON 字串。不太适合存储比较复杂或存储空间要求比较大的数据，也不适合存储静态的文件等。</p><p>在 Android 内嵌 Webview 中，需要通过 Webview 设置接口启用 Dom Storage。</p><div><div id="highlighter_884387" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">WebView&nbsp;myWebView&nbsp;=&nbsp;(WebView)&nbsp;findViewById(R.id.webview);</code></div><div class="line number2 index1 alt1"><code class="js plain">WebSettings&nbsp;webSettings&nbsp;=&nbsp;myWebView.getSettings();</code></div><div class="line number3 index2 alt2"><code class="js plain">webSettings.setDomStorageEnabled(</code><code class="js keyword">true</code><code class="js plain">);</code></div></div></td></tr></tbody></table></div></div><p>拿 Android 类比的话，Web 的 Dom Storage 机制类似于 Android 的 SharedPreference 机制。</p><p><span style="font-size: 16px;"><strong>2.3 Web SQL Database存储机制</strong></span></p><p>H5 也提供基于 SQL 的数据库存储机制，用于存储适合数据库的结构化数据。根据官方的标准文档，Web SQL Database 存储机制不再推荐使用，将来也不再维护，而是推荐使用 AppCache 和 IndexedDB。</p><p>现在主流的浏览器（点击查看浏览器支持情况）都还是支持 Web SQL Database 存储机制的。Web SQL Database 存储机制提供了一组 API 供 Web App 创建、存储、查询数据库。</p><p>下面通过简单的例子，演示下 Web SQL Database 的使用。</p><div><div id="highlighter_239505" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code><code class="js plain">(window.openDatabase){</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//打开数据库，如果没有则创建</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">db&nbsp;=&nbsp;openDatabase(</code><code class="js string">'mydb'</code><code class="js plain">,&nbsp;</code><code class="js string">'1.0'</code><code class="js plain">,&nbsp;</code><code class="js string">'Test&nbsp;DB'</code><code class="js plain">,&nbsp;2&nbsp;*&nbsp;1024);</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//通过事务，创建一个表，并添加两条记录</code></div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">db.transaction(</code><code class="js keyword">function</code>&nbsp;<code class="js plain">(tx)&nbsp;{</code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">tx.executeSql(</code><code class="js string">'CREATE&nbsp;TABLE&nbsp;IF&nbsp;NOT&nbsp;EXISTS&nbsp;LOGS&nbsp;(id&nbsp;unique,&nbsp;log)'</code><code class="js plain">);</code></div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">tx.executeSql(</code><code class="js string">'INSERT&nbsp;INTO&nbsp;LOGS&nbsp;(id,&nbsp;log)&nbsp;VALUES&nbsp;(1,&nbsp;"foobar")'</code><code class="js plain">);</code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">tx.executeSql(</code><code class="js string">'INSERT&nbsp;INTO&nbsp;LOGS&nbsp;(id,&nbsp;log)&nbsp;VALUES&nbsp;(2,&nbsp;"logmsg")'</code><code class="js plain">);</code></div><div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">});</code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//查询表中所有记录，并展示出来</code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">db.transaction(</code><code class="js keyword">function</code>&nbsp;<code class="js plain">(tx)&nbsp;{</code></div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">tx.executeSql(</code><code class="js string">'SELECT&nbsp;*&nbsp;FROM&nbsp;LOGS'</code><code class="js plain">,&nbsp;[],&nbsp;</code><code class="js keyword">function</code>&nbsp;<code class="js plain">(tx,&nbsp;results)&nbsp;{</code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">len&nbsp;=&nbsp;results.rows.length,&nbsp;i;</code></div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">msg&nbsp;=&nbsp;</code><code class="js string">"Found&nbsp;rows:&nbsp;"</code>&nbsp;<code class="js plain">+&nbsp;len&nbsp;+&nbsp;</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">for</code><code class="js plain">(i=0;&nbsp;i</code><code class="js string">"&nbsp;+&nbsp;results.rows.item(i).log&nbsp;+&nbsp;"</code><code class="js plain">";</code></div><div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">'#status'</code><code class="js plain">).innerHTML&nbsp;=&nbsp;&nbsp;msg;</code></div><div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">},&nbsp;</code><code class="js keyword">null</code><code class="js plain">);</code></div><div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">});</code></div><div class="line number20 index19 alt1"><code class="js plain">}Status&nbsp;Message</code></div></div></td></tr></tbody></table></div></div><p>将上面代码复制到 sql_database.html 中，用浏览器打开，可看到下面的内容。</p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450237383557340.gif" title="1450237383557340.gif" alt="ZSA5PB2.gif" style="width: 384px; height: 130px;"></p><p>官方建议浏览器在实现时，对每个 HOST 的数据库存储空间作一定限制，建议默认是 5MB（分 HOST）的配额；达到上限后，可以申请更多存储空间。另外，现在主流浏览器 SQL Database 的实现都是基于 SQLite。</p><p>分析：SQL Database 的主要优势在于能够存储结构复杂的数据，能充分利用数据库的优势，可方便对数据进行增加、删除、修改、查询。由于 SQL 语法的复杂性，使用起来麻烦一些。SQL Database 也不太适合做静态文件的缓存。</p><p>在 Android 内嵌 Webview 中，需要通过 Webview 设置接口启用 SQL Database，同时还要设置数据库文件的存储路径。</p><div><div id="highlighter_271745" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">WebView&nbsp;myWebView&nbsp;=&nbsp;(WebView)&nbsp;findViewById(R.id.webview);</code></div><div class="line number2 index1 alt1"><code class="js plain">WebSettings&nbsp;webSettings&nbsp;=&nbsp;myWebView.getSettings();</code></div><div class="line number3 index2 alt2"><code class="js plain">webSettings.setDatabaseEnabled(</code><code class="js keyword">true</code><code class="js plain">);</code></div><div class="line number4 index3 alt1"><code class="js plain">final&nbsp;String&nbsp;dbPath&nbsp;=&nbsp;getApplicationContext().getDir(</code><code class="js string">"db"</code><code class="js plain">,&nbsp;Context.MODE_PRIVATE).getPath();</code></div><div class="line number5 index4 alt2"><code class="js plain">webSettings.setDatabasePath(dbPath);</code></div></div></td></tr></tbody></table></div></div><p>Android 系统也使用了大量的数据库用来存储数据，比如联系人、短消息等；数据库的格式也 SQLite。Android 也提供了 API 来操作 SQLite。Web SQL Database 存储机制就是通过提供一组 API，借助浏览器的实现，将这种 Native 的功能提供给了 Web App。</p><p><span style="font-size: 16px;"><strong>2.4 Application Cache 机制</strong></span></p><p>Application Cache（简称 AppCache)似乎是为支持 Web App 离线使用而开发的缓存机制。它的缓存机制类似于浏览器的缓存（Cache-Control 和 Last-Modified）机制，都是以文件为单位进行缓存，且文件有一定更新机制。但 AppCache 是对浏览器缓存机制的补充，不是替代。</p><p>先拿 W3C 官方的一个例子，说下 AppCache 机制的用法与功能。</p><div><div id="highlighter_348080" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">Get&nbsp;Date&nbsp;and&nbsp;TimeTry&nbsp;opening&nbsp;</code><code class="js keyword">this</code>&nbsp;<code class="js plain">page,&nbsp;then&nbsp;go&nbsp;offline,&nbsp;and&nbsp;reload&nbsp;the&nbsp;page.&nbsp;The&nbsp;script&nbsp;and&nbsp;the&nbsp;image&nbsp;should&nbsp;still&nbsp;work.</code></div></div></td></tr></tbody></table></div></div><p>上面 HTML 文档，引用外部一个 JS 文件和一个 GIF 图片文件，在其 HTML 头中通过 manifest 属性引用了一个 appcache 结尾的文件。</p><p>我们在 Google Chrome 浏览器中打开这个 HTML 链接，JS 功能正常，图片也显示正常。禁用网络，关闭浏览器重新打开这个链接，发现 JS 工作正常，图片也显示正常。当然也有可能是浏览缓存起的作用，我们可以在文件的浏览器缓存过期后，禁用网络再试，发现 HTML 页面也是正常的。</p><p>通过 Google Chrome 浏览器自带的工具，我们可以查看已经缓存的 AppCache（分 HOST)。</p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450237550639902.gif" title="1450237550639902.gif" alt="hq9dR63.gif" style="width: 379px; height: 224px;"></p><p>上面截图中的缓存，就是我们刚才打开 HTML 的页面 AppCache。从截图中看，HTML 页面及 HTML 引用的 JS、GIF 图像文件都被缓存了；另外 HTML 头中 manifest 属性引用的 appcache 文件也缓存了。</p><p>AppCache 的原理有两个关键点：manifest 属性和 manifest 文件。</p><p>HTML 在头中通过 manifest 属性引用 manifest 文件。manifest 文件，就是上面以 appcache 结尾的文件，是一个普通文件文件，列出了需要缓存的文件。</p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450238284890808.gif" title="1450238284890808.gif" alt="bMFTDmR.gif" style="width: 381px; height: 103px;"></p><p>上面截图中的 manifest 文件，就 HTML 代码引用的 manifest 文件。文件比较简单，第一行是关键字，第二、三行就是要缓存的文件路径（相对路径）。这只是最简单的 manifest 文件，完整的还包括其他关键字与内容。引用 manifest 文件的 HTML 和 manifest 文件中列出的要缓存的文件最终都会被浏览器缓存。</p><p>完整的 manifest 文件，包括三个 Section，类型 Windows 中 ini 配置文件的 Section，不过不要中括号。</p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p>CACHE MANIFEST - Files listed under this header will be cached after they are downloaded for the first time</p></li><li><p>NETWORK - Files listed under this header require a connection to the server, and will never be cached</p></li><li><p>FALLBACK - Files listed under this header specifies fallback pages if a page is inaccessible</p></li></ol><p>完整的 manifest 文件，如：</p><div><div id="highlighter_355869" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">CACHE&nbsp;MANIFEST</code></div><div class="line number2 index1 alt1"><code class="js preprocessor">#&nbsp;2012-02-21&nbsp;v1.0.0</code></div><div class="line number3 index2 alt2"><code class="js plain">/theme.css</code></div><div class="line number4 index3 alt1"><code class="js plain">/logo.gif</code></div><div class="line number5 index4 alt2"><code class="js plain">/main.js</code></div><div class="line number6 index5 alt1"><code class="js plain">NETWORK:</code></div><div class="line number7 index6 alt2"><code class="js plain">login.asp</code></div><div class="line number8 index7 alt1"><code class="js plain">FALLBACK:</code></div><div class="line number9 index8 alt2"><code class="js plain">/html/&nbsp;/offline.html</code></div></div></td></tr></tbody></table></div></div><p>总的来说，浏览器在首次加载 HTML 文件时，会解析 manifest 属性，并读取 manifest 文件，获取 Section：CACHE MANIFEST 下要缓存的文件列表，再对文件缓存。</p><p>AppCache 的缓存文件，与浏览器的缓存文件分开存储的，还是一份？应该是分开的。因为 AppCache 在本地也有 5MB（分 HOST）的空间限制。</p><p>AppCache 在首次加载生成后，也有更新机制。被缓存的文件如果要更新，需要更新 manifest 文件。因为浏览器在下次加载时，除了会默认使用缓存外，还会在后台检查 manifest 文件有没有修改（byte by byte)。发现有修改，就会重新获取 manifest 文件，对 Section：CACHE MANIFEST 下文件列表检查更新。manifest 文件与缓存文件的检查更新也遵守浏览器缓存机制。</p><p>如用用户手动清了 AppCache 缓存，下次加载时，浏览器会重新生成缓存，也可算是一种缓存的更新。另外， Web App 也可用代码实现缓存更新。</p><p>分析：AppCache 看起来是一种比较好的缓存方法，除了缓存静态资源文件外，也适合构建 Web 离线 App。在实际使用中有些需要注意的地方，有一些可以说是”坑“。</p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p>要更新缓存的文件，需要更新包含它的 manifest 文件，那怕只加一个空格。常用的方法，是修改 manifest 文件注释中的版本号。如：# 2012-02-21 v1.0.0</p></li><li><p>被缓存的文件，浏览器是先使用，再通过检查 manifest 文件是否有更新来更新缓存文件。这样缓存文件可能用的不是最新的版本。</p></li><li><p>在更新缓存过程中，如果有一个文件更新失败，则整个更新会失败。</p></li><li><p>manifest 和引用它的HTML要在相同 HOST。</p></li><li><p>manifest 文件中的文件列表，如果是相对路径，则是相对 manifest 文件的相对路径。</p></li><li><p>manifest 也有可能更新出错，导致缓存文件更新失败。</p></li><li><p>没有缓存的资源在已经缓存的 HTML 中不能加载，即使有网络。例如：<a href="http://appcache-demo.s3-website-us-east-1.amazonaws.com/without-network/" target="_blank">http://appcache-demo.s3-website-us-east-1.amazonaws.com/without-network/</a></p></li><li><p>manifest 文件本身不能被缓存，且 manifest 文件的更新使用的是浏览器缓存机制。所以 manifest 文件的 Cache-Control 缓存时间不能设置太长。</p></li></ol><p>另外，根据官方文档，AppCache 已经不推荐使用了，标准也不会再支持。现在主流的浏览器都是还支持 AppCache的，以后就不太确定了。</p><p>在Android 内嵌 Webview中，需要通过 Webview 设置接口启用 AppCache，同时还要设置缓存文件的存储路径，另外还可以设置缓存的空间大小。</p><div><div id="highlighter_361635" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">WebView&nbsp;myWebView&nbsp;=&nbsp;(WebView)&nbsp;findViewById(R.id.webview);</code></div><div class="line number2 index1 alt1"><code class="js plain">WebSettings&nbsp;webSettings&nbsp;=&nbsp;myWebView.getSettings();</code></div><div class="line number3 index2 alt2"><code class="js plain">webSettings.setAppCacheEnabled(</code><code class="js keyword">true</code><code class="js plain">);</code></div><div class="line number4 index3 alt1"><code class="js plain">final&nbsp;String&nbsp;cachePath&nbsp;=&nbsp;getApplicationContext().getDir(</code><code class="js string">"cache"</code><code class="js plain">,&nbsp;Context.MODE_PRIVATE).getPath();</code></div><div class="line number5 index4 alt2"><code class="js plain">webSettings.setAppCachePath(cachePath);</code></div><div class="line number6 index5 alt1"><code class="js plain">webSettings.setAppCacheMaxSize(5*1024*1024);</code></div></div></td></tr></tbody></table></div></div><p><span style="font-size: 16px;"><strong>2.5 Indexed Database</strong></span></p><p>IndexedDB 也是一种数据库的存储机制，但不同于已经不再支持的 Web SQL Database。IndexedDB 不是传统的关系数据库，可归为 NoSQL 数据库。IndexedDB 又类似于 Dom Storage 的 key-value 的存储方式，但功能更强大，且存储空间更大。</p><p>IndexedDB 存储数据是 key-value 的形式。Key 是必需，且要唯一；Key 可以自己定义，也可由系统自动生成。Value 也是必需的，但 Value 非常灵活，可以是任何类型的对象。一般 Value 都是通过 Key 来存取的。</p><p>IndexedDB 提供了一组 API，可以进行数据存、取以及遍历。这些 API 都是异步的，操作的结果都是在回调中返回。</p><p>下面代码演示了 IndexedDB 中 DB 的打开（创建）、存储对象(可理解成有关系数据的”表“）的创建及数据存取、遍历基本功能。</p><div><div id="highlighter_578787" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div><div class="line number102 index101 alt1">102</div><div class="line number103 index102 alt2">103</div><div class="line number104 index103 alt1">104</div><div class="line number105 index104 alt2">105</div><div class="line number106 index105 alt1">106</div><div class="line number107 index106 alt2">107</div><div class="line number108 index107 alt1">108</div><div class="line number109 index108 alt2">109</div><div class="line number110 index109 alt1">110</div><div class="line number111 index110 alt2">111</div><div class="line number112 index111 alt1">112</div><div class="line number113 index112 alt2">113</div><div class="line number114 index113 alt1">114</div><div class="line number115 index114 alt2">115</div><div class="line number116 index115 alt1">116</div><div class="line number117 index116 alt2">117</div><div class="line number118 index117 alt1">118</div><div class="line number119 index118 alt2">119</div><div class="line number120 index119 alt1">120</div><div class="line number121 index120 alt2">121</div><div class="line number122 index121 alt1">122</div><div class="line number123 index122 alt2">123</div><div class="line number124 index123 alt1">124</div><div class="line number125 index124 alt2">125</div><div class="line number126 index125 alt1">126</div><div class="line number127 index126 alt2">127</div><div class="line number128 index127 alt1">128</div><div class="line number129 index128 alt2">129</div><div class="line number130 index129 alt1">130</div><div class="line number131 index130 alt2">131</div><div class="line number132 index131 alt1">132</div><div class="line number133 index132 alt2">133</div><div class="line number134 index133 alt1">134</div><div class="line number135 index134 alt2">135</div><div class="line number136 index135 alt1">136</div><div class="line number137 index136 alt2">137</div><div class="line number138 index137 alt1">138</div><div class="line number139 index138 alt2">139</div><div class="line number140 index139 alt1">140</div><div class="line number141 index140 alt2">141</div><div class="line number142 index141 alt1">142</div><div class="line number143 index142 alt2">143</div><div class="line number144 index143 alt1">144</div><div class="line number145 index144 alt2">145</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js keyword">var</code>&nbsp;<code class="js plain">db;</code></div><div class="line number2 index1 alt1"><code class="js plain">window.indexedDB&nbsp;=&nbsp;window.indexedDB&nbsp;||&nbsp;window.mozIndexedDB&nbsp;||&nbsp;window.webkitIndexedDB&nbsp;||&nbsp;window.msIndexedDB;</code></div><div class="line number3 index2 alt2"><code class="js comments">//浏览器是否支持IndexedDB</code></div><div class="line number4 index3 alt1"><code class="js keyword">if</code>&nbsp;<code class="js plain">(window.indexedDB)&nbsp;{</code></div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js comments">//打开数据库，如果没有，则创建</code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">openRequest&nbsp;=&nbsp;window.indexedDB.open(</code><code class="js string">"people_db"</code><code class="js plain">,&nbsp;1);</code></div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js comments">//DB版本设置或升级时回调</code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">openRequest.onupgradeneeded&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">"Upgrading..."</code><code class="js plain">);</code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">thisDB&nbsp;=&nbsp;e.target.result;</code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code><code class="js plain">(!thisDB.objectStoreNames.contains(</code><code class="js string">"people"</code><code class="js plain">))&nbsp;{</code></div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">"Create&nbsp;Object&nbsp;Store:&nbsp;people."</code><code class="js plain">);</code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//创建存储对象，类似于关系数据库的表</code></div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">thisDB.createObjectStore(</code><code class="js string">"people"</code><code class="js plain">,&nbsp;{&nbsp;autoIncrement:</code><code class="js keyword">true</code>&nbsp;<code class="js plain">});</code></div><div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//创建存储对象，&nbsp;还创建索引</code></div><div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//var&nbsp;objectStore&nbsp;=&nbsp;thisDB.createObjectStore("people",{&nbsp;autoIncrement:true&nbsp;});</code></div><div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//&nbsp;//first&nbsp;arg&nbsp;is&nbsp;name&nbsp;of&nbsp;index,&nbsp;second&nbsp;is&nbsp;the&nbsp;path&nbsp;(col);</code></div><div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//objectStore.createIndex("name","name",&nbsp;{unique:false});</code></div><div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//objectStore.createIndex("email","email",&nbsp;{unique:true});</code></div><div class="line number20 index19 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number21 index20 alt2"><code class="js plain">}</code></div><div class="line number22 index21 alt1"><code class="js comments">//DB成功打开回调</code></div><div class="line number23 index22 alt2"><code class="js plain">openRequest.onsuccess&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number24 index23 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">"Success!"</code><code class="js plain">);</code></div><div class="line number25 index24 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//保存全局的数据库对象，后面会用到</code></div><div class="line number26 index25 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">db&nbsp;=&nbsp;e.target.result;</code></div><div class="line number27 index26 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js comments">//绑定按钮点击事件</code></div><div class="line number28 index27 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#addButton"</code><code class="js plain">).addEventListener(</code><code class="js string">"click"</code><code class="js plain">,&nbsp;addPerson,&nbsp;</code><code class="js keyword">false</code><code class="js plain">);</code></div><div class="line number29 index28 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#getButton"</code><code class="js plain">).addEventListener(</code><code class="js string">"click"</code><code class="js plain">,&nbsp;getPerson,&nbsp;</code><code class="js keyword">false</code><code class="js plain">);</code></div><div class="line number30 index29 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#getAllButton"</code><code class="js plain">).addEventListener(</code><code class="js string">"click"</code><code class="js plain">,&nbsp;getPeople,&nbsp;</code><code class="js keyword">false</code><code class="js plain">);</code></div><div class="line number31 index30 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#getByName"</code><code class="js plain">).addEventListener(</code><code class="js string">"click"</code><code class="js plain">,&nbsp;getPeopleByNameIndex1,&nbsp;</code><code class="js keyword">false</code><code class="js plain">);</code></div><div class="line number32 index31 alt1"><code class="js plain">}</code></div><div class="line number33 index32 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//DB打开失败回调</code></div><div class="line number34 index33 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">openRequest.onerror&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number35 index34 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">"Error"</code><code class="js plain">);</code></div><div class="line number36 index35 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.dir(e);</code></div><div class="line number37 index36 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number38 index37 alt1"><code class="js plain">}</code><code class="js keyword">else</code><code class="js plain">{</code></div><div class="line number39 index38 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">alert(</code><code class="js string">'Sorry!&nbsp;Your&nbsp;browser&nbsp;doesn\'t&nbsp;support&nbsp;the&nbsp;IndexedDB.'</code><code class="js plain">);</code></div><div class="line number40 index39 alt1"><code class="js plain">}</code></div><div class="line number41 index40 alt2"><code class="js comments">//添加一条记录</code></div><div class="line number42 index41 alt1"><code class="js keyword">function</code>&nbsp;<code class="js plain">addPerson(e)&nbsp;{</code></div><div class="line number43 index42 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">name&nbsp;=&nbsp;document.querySelector(</code><code class="js string">"#name"</code><code class="js plain">).value;</code></div><div class="line number44 index43 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">email&nbsp;=&nbsp;document.querySelector(</code><code class="js string">"#email"</code><code class="js plain">).value;</code></div><div class="line number45 index44 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">"About&nbsp;to&nbsp;add&nbsp;"</code><code class="js plain">+name+</code><code class="js string">"/"</code><code class="js plain">+email);</code></div><div class="line number46 index45 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">transaction&nbsp;=&nbsp;db.transaction([</code><code class="js string">"people"</code><code class="js plain">],</code><code class="js string">"readwrite"</code><code class="js plain">);</code></div><div class="line number47 index46 alt2"><code class="js keyword">var</code>&nbsp;<code class="js plain">store&nbsp;=&nbsp;transaction.objectStore(</code><code class="js string">"people"</code><code class="js plain">);</code></div><div class="line number48 index47 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js comments">//Define&nbsp;a&nbsp;person</code></div><div class="line number49 index48 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">person&nbsp;=&nbsp;{</code></div><div class="line number50 index49 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">name:name,</code></div><div class="line number51 index50 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">email:email,</code></div><div class="line number52 index51 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">created:</code><code class="js keyword">new</code>&nbsp;<code class="js plain">Date()</code></div><div class="line number53 index52 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number54 index53 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js comments">//Perform&nbsp;the&nbsp;add</code></div><div class="line number55 index54 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">request&nbsp;=&nbsp;store.add(person);</code></div><div class="line number56 index55 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js comments">//var&nbsp;request&nbsp;=&nbsp;store.put(person,&nbsp;2);</code></div><div class="line number57 index56 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">request.onerror&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number58 index57 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">"Error"</code><code class="js plain">,e.target.error.name);</code></div><div class="line number59 index58 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//some&nbsp;type&nbsp;of&nbsp;error&nbsp;handler</code></div><div class="line number60 index59 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number61 index60 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">request.onsuccess&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number62 index61 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">"Woot!&nbsp;Did&nbsp;it."</code><code class="js plain">);</code></div><div class="line number63 index62 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number64 index63 alt1"><code class="js plain">}</code></div><div class="line number65 index64 alt2"><code class="js comments">//通过KEY查询记录</code></div><div class="line number66 index65 alt1"><code class="js keyword">function</code>&nbsp;<code class="js plain">getPerson(e)&nbsp;{</code></div><div class="line number67 index66 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">key&nbsp;=&nbsp;document.querySelector(</code><code class="js string">"#key"</code><code class="js plain">).value;</code></div><div class="line number68 index67 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code><code class="js plain">(key&nbsp;===&nbsp;</code><code class="js string">""</code>&nbsp;<code class="js plain">||&nbsp;isNaN(key))&nbsp;</code><code class="js keyword">return</code><code class="js plain">;</code></div><div class="line number69 index68 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">transaction&nbsp;=&nbsp;db.transaction([</code><code class="js string">"people"</code><code class="js plain">],</code><code class="js string">"readonly"</code><code class="js plain">);</code></div><div class="line number70 index69 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">store&nbsp;=&nbsp;transaction.objectStore(</code><code class="js string">"people"</code><code class="js plain">);</code></div><div class="line number71 index70 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">request&nbsp;=&nbsp;store.get(Number(key));</code></div><div class="line number72 index71 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">request.onsuccess&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number73 index72 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">result&nbsp;=&nbsp;e.target.result;</code></div><div class="line number74 index73 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.dir(result);</code></div><div class="line number75 index74 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code><code class="js plain">(result)&nbsp;{</code></div><div class="line number76 index75 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">s&nbsp;=&nbsp;</code><code class="js string">"Key&nbsp;"</code><code class="js plain">+key+</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number77 index76 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">for</code><code class="js plain">(</code><code class="js keyword">var</code>&nbsp;<code class="js plain">field&nbsp;</code><code class="js keyword">in</code>&nbsp;<code class="js plain">result)&nbsp;{</code></div><div class="line number78 index77 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">s+=&nbsp;field+</code><code class="js string">"="</code><code class="js plain">+result[field]+</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number79 index78 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number80 index79 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#status"</code><code class="js plain">).innerHTML&nbsp;=&nbsp;s;</code></div><div class="line number81 index80 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}&nbsp;</code><code class="js keyword">else</code>&nbsp;<code class="js plain">{</code></div><div class="line number82 index81 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#status"</code><code class="js plain">).innerHTML&nbsp;=&nbsp;</code><code class="js string">"No&nbsp;match!"</code><code class="js plain">;</code></div><div class="line number83 index82 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number84 index83 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number85 index84 alt2"><code class="js plain">}</code></div><div class="line number86 index85 alt1"><code class="js comments">//获取所有记录</code></div><div class="line number87 index86 alt2"><code class="js keyword">function</code>&nbsp;<code class="js plain">getPeople(e)&nbsp;{</code></div><div class="line number88 index87 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">s&nbsp;=&nbsp;</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number89 index88 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">db.transaction([</code><code class="js string">"people"</code><code class="js plain">],&nbsp;</code><code class="js string">"readonly"</code><code class="js plain">).objectStore(</code><code class="js string">"people"</code><code class="js plain">).openCursor().onsuccess&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number90 index89 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">cursor&nbsp;=&nbsp;e.target.result;</code></div><div class="line number91 index90 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code><code class="js plain">(cursor)&nbsp;{</code></div><div class="line number92 index91 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">s&nbsp;+=&nbsp;</code><code class="js string">"Key&nbsp;"</code><code class="js plain">+cursor.key+</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number93 index92 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">for</code><code class="js plain">(</code><code class="js keyword">var</code>&nbsp;<code class="js plain">field&nbsp;</code><code class="js keyword">in</code>&nbsp;<code class="js plain">cursor.value)&nbsp;{</code></div><div class="line number94 index93 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">s+=&nbsp;field+</code><code class="js string">"="</code><code class="js plain">+cursor.value[field]+</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number95 index94 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number96 index95 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">s+=</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number97 index96 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">cursor.</code><code class="js keyword">continue</code><code class="js plain">();</code></div><div class="line number98 index97 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number99 index98 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#status2"</code><code class="js plain">).innerHTML&nbsp;=&nbsp;s;</code></div><div class="line number100 index99 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number101 index100 alt2"><code class="js plain">}</code></div><div class="line number102 index101 alt1"><code class="js comments">//通过索引查询记录</code></div><div class="line number103 index102 alt2"><code class="js keyword">function</code>&nbsp;<code class="js plain">getPeopleByNameIndex(e)</code></div><div class="line number104 index103 alt1"><code class="js plain">{</code></div><div class="line number105 index104 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">name&nbsp;=&nbsp;document.querySelector(</code><code class="js string">"#name1"</code><code class="js plain">).value;</code></div><div class="line number106 index105 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">transaction&nbsp;=&nbsp;db.transaction([</code><code class="js string">"people"</code><code class="js plain">],</code><code class="js string">"readonly"</code><code class="js plain">);</code></div><div class="line number107 index106 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">store&nbsp;=&nbsp;transaction.objectStore(</code><code class="js string">"people"</code><code class="js plain">);</code></div><div class="line number108 index107 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">index&nbsp;=&nbsp;store.index(</code><code class="js string">"name"</code><code class="js plain">);</code></div><div class="line number109 index108 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//name&nbsp;is&nbsp;some&nbsp;value</code></div><div class="line number110 index109 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">request&nbsp;=&nbsp;index.get(name);</code></div><div class="line number111 index110 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">request.onsuccess&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number112 index111 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">result&nbsp;=&nbsp;e.target.result;</code></div><div class="line number113 index112 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code><code class="js plain">(result)&nbsp;{</code></div><div class="line number114 index113 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">s&nbsp;=&nbsp;</code><code class="js string">"Name&nbsp;"</code><code class="js plain">+name+</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number115 index114 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">for</code><code class="js plain">(</code><code class="js keyword">var</code>&nbsp;<code class="js plain">field&nbsp;</code><code class="js keyword">in</code>&nbsp;<code class="js plain">result)&nbsp;{</code></div><div class="line number116 index115 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">s+=&nbsp;field+</code><code class="js string">"="</code><code class="js plain">+result[field]+</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number117 index116 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number118 index117 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">s+=</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number119 index118 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}&nbsp;</code><code class="js keyword">else</code>&nbsp;<code class="js plain">{</code></div><div class="line number120 index119 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#status3"</code><code class="js plain">).innerHTML&nbsp;=&nbsp;</code><code class="js string">"No&nbsp;match!"</code><code class="js plain">;</code></div><div class="line number121 index120 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number122 index121 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number123 index122 alt2"><code class="js plain">}</code></div><div class="line number124 index123 alt1"><code class="js comments">//通过索引查询记录</code></div><div class="line number125 index124 alt2"><code class="js keyword">function</code>&nbsp;<code class="js plain">getPeopleByNameIndex1(e)</code></div><div class="line number126 index125 alt1"><code class="js plain">{</code></div><div class="line number127 index126 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">s&nbsp;=&nbsp;</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number128 index127 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">name&nbsp;=&nbsp;document.querySelector(</code><code class="js string">"#name1"</code><code class="js plain">).value;</code></div><div class="line number129 index128 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">transaction&nbsp;=&nbsp;db.transaction([</code><code class="js string">"people"</code><code class="js plain">],</code><code class="js string">"readonly"</code><code class="js plain">);</code></div><div class="line number130 index129 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">store&nbsp;=&nbsp;transaction.objectStore(</code><code class="js string">"people"</code><code class="js plain">);</code></div><div class="line number131 index130 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">index&nbsp;=&nbsp;store.index(</code><code class="js string">"name"</code><code class="js plain">);</code></div><div class="line number132 index131 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//name&nbsp;is&nbsp;some&nbsp;value</code></div><div class="line number133 index132 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">index.openCursor().onsuccess&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number134 index133 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">cursor&nbsp;=&nbsp;e.target.result;</code></div><div class="line number135 index134 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code><code class="js plain">(cursor)&nbsp;{</code></div><div class="line number136 index135 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">s&nbsp;+=&nbsp;</code><code class="js string">"Key&nbsp;"</code><code class="js plain">+cursor.key+</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number137 index136 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">for</code><code class="js plain">(</code><code class="js keyword">var</code>&nbsp;<code class="js plain">field&nbsp;</code><code class="js keyword">in</code>&nbsp;<code class="js plain">cursor.value)&nbsp;{</code></div><div class="line number138 index137 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">s+=&nbsp;field+</code><code class="js string">"="</code><code class="js plain">+cursor.value[field]+</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number139 index138 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number140 index139 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">s+=</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number141 index140 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">cursor.</code><code class="js keyword">continue</code><code class="js plain">();</code></div><div class="line number142 index141 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number143 index142 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#status3"</code><code class="js plain">).innerHTML&nbsp;=&nbsp;s;</code></div><div class="line number144 index143 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number145 index144 alt2"><code class="js plain">}添加数据Add&nbsp;Data根据Key查询数据Get&nbsp;Data获取所有数据Get&nbsp;EveryOne根据索引:Name查询数据&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;ByName</code></div></div></td></tr></tbody></table></div></div><p>将上面的代码复制到 indexed_db.html 中，用 Google Chrome 浏览器打开，就可以添加、查询数据。在 Chrome 的开发者工具中，能查看创建的 DB 、存储对象(可理解成表）以及表中添加的数据。<br></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450238494780379.png" title="1450238494780379.png" alt="EauZGwV.png" style="width: 421px; height: 150px;"></p><p>IndexedDB 有个非常强大的功能，就是 index（索引）。它可对 Value 对象中任何属性生成索引，然后可以基于索引进行 Value 对象的快速查询。</p><p>要生成索引或支持索引查询数据，需求在首次生成存储对象时，调用接口生成属性的索引。可以同时对对象的多个不同属性创建索引。如下面代码就对name 和 email 两个属性都生成了索引。</p><div><div id="highlighter_293595" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js keyword">var</code>&nbsp;<code class="js plain">objectStore&nbsp;=&nbsp;thisDB.createObjectStore(</code><code class="js string">"people"</code><code class="js plain">,{&nbsp;autoIncrement:</code><code class="js keyword">true</code>&nbsp;<code class="js plain">});</code></div><div class="line number2 index1 alt1"><code class="js comments">//first&nbsp;arg&nbsp;is&nbsp;name&nbsp;of&nbsp;index,&nbsp;second&nbsp;is&nbsp;the&nbsp;path&nbsp;(col);</code></div><div class="line number3 index2 alt2"><code class="js plain">objectStore.createIndex(</code><code class="js string">"name"</code><code class="js plain">,</code><code class="js string">"name"</code><code class="js plain">,&nbsp;{unique:</code><code class="js keyword">false</code><code class="js plain">});</code></div><div class="line number4 index3 alt1"><code class="js plain">objectStore.createIndex(</code><code class="js string">"email"</code><code class="js plain">,</code><code class="js string">"email"</code><code class="js plain">,&nbsp;{unique:</code><code class="js keyword">true</code><code class="js plain">});</code></div></div></td></tr></tbody></table></div></div><p>生成索引后，就可以基于索引进行数据的查询。</p><div><div id="highlighter_358126" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js keyword">function</code>&nbsp;<code class="js plain">getPeopleByNameIndex(e)</code></div><div class="line number2 index1 alt1"><code class="js plain">{</code></div><div class="line number3 index2 alt2"><code class="js keyword">var</code>&nbsp;<code class="js plain">name&nbsp;=&nbsp;document.querySelector(</code><code class="js string">"#name1"</code><code class="js plain">).value;</code></div><div class="line number4 index3 alt1"><code class="js keyword">var</code>&nbsp;<code class="js plain">transaction&nbsp;=&nbsp;db.transaction([</code><code class="js string">"people"</code><code class="js plain">],</code><code class="js string">"readonly"</code><code class="js plain">);</code></div><div class="line number5 index4 alt2"><code class="js keyword">var</code>&nbsp;<code class="js plain">store&nbsp;=&nbsp;transaction.objectStore(</code><code class="js string">"people"</code><code class="js plain">);</code></div><div class="line number6 index5 alt1"><code class="js keyword">var</code>&nbsp;<code class="js plain">index&nbsp;=&nbsp;store.index(</code><code class="js string">"name"</code><code class="js plain">);</code></div><div class="line number7 index6 alt2"><code class="js comments">//name&nbsp;is&nbsp;some&nbsp;value</code></div><div class="line number8 index7 alt1"><code class="js keyword">var</code>&nbsp;<code class="js plain">request&nbsp;=&nbsp;index.get(name);</code></div><div class="line number9 index8 alt2"><code class="js plain">request.onsuccess&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">result&nbsp;=&nbsp;e.target.result;</code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code><code class="js plain">(result)&nbsp;{</code></div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">s&nbsp;=&nbsp;</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}&nbsp;</code><code class="js keyword">else</code>&nbsp;<code class="js plain">{</code></div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.querySelector(</code><code class="js string">"#status3"</code><code class="js plain">).innerHTML&nbsp;=&nbsp;</code><code class="js string">""</code><code class="js plain">;</code></div><div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number17 index16 alt2"><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div><p>分析：IndexedDB 是一种灵活且功能强大的数据存储机制，它集合了 Dom Storage 和 Web SQL Database 的优点，用于存储大块或复杂结构的数据，提供更大的存储空间，使用起来也比较简单。可以作为 Web SQL Database 的替代。不太适合静态文件的缓存。</p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p>以key-value 的方式存取对象，可以是任何类型值或对象，包括二进制。</p></li><li><p>可以对对象任何属性生成索引，方便查询。</p></li><li><p>较大的存储空间，默认推荐250MB(分 HOST)，比 Dom Storage 的5MB 要大的多。</p></li><li><p>通过数据库的事务（tranction）机制进行数据操作，保证数据一致性。</p></li><li><p>异步的 API 调用，避免造成等待而影响体验。</p></li></ol><p>Android 在4.4开始加入对 IndexedDB 的支持，只需打开允许 JS 执行的开关就好了。</p><div><div id="highlighter_34868" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">WebView&nbsp;myWebView&nbsp;=&nbsp;(WebView)&nbsp;findViewById(R.id.webview);</code></div><div class="line number2 index1 alt1"><code class="js plain">WebSettings&nbsp;webSettings&nbsp;=&nbsp;myWebView.getSettings();</code></div><div class="line number3 index2 alt2"><code class="js plain">webSettings.setJavaScriptEnabled(</code><code class="js keyword">true</code><code class="js plain">);</code></div></div></td></tr></tbody></table></div></div><p><span style="font-size: 16px;"><strong>2.6 File System API</strong></span></p><p>File System API 是 H5 新加入的存储机制。它为 Web App 提供了一个虚拟的文件系统，就像 Native App 访问本地文件系统一样。由于安全性的考虑，这个虚拟文件系统有一定的限制。Web App 在虚拟的文件系统中，可以进行文件（夹）的创建、读、写、删除、遍历等操作。</p><p>File System API 也是一种可选的缓存机制，和前面的 SQLDatabase、IndexedDB 和 AppCache 等一样。File System API 有自己的一些特定的优势：</p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p>可以满足大块的二进制数据（ large binary blobs）存储需求。</p></li><li><p>可以通过预加载资源文件来提高性能。</p></li><li><p>可以直接编辑文件。</p></li></ol><p>浏览器给虚拟文件系统提供了两种类型的存储空间：临时的和持久性的。临时的存储空间是由浏览器自动分配的，但可能被浏览器回收；持久性的存储空间需要显示的申请，申请时浏览器会给用户一提示，需要用户进行确认。持久性的存储空间是 WebApp 自己管理，浏览器不会回收，也不会清除内容。持久性的存储空间大小是通过配额来管理的，首次申请时会一个初始的配额，配额用完需要再次申请。</p><p>虚拟的文件系统是运行在沙盒中。不同 WebApp 的虚拟文件系统是互相隔离的，虚拟文件系统与本地文件系统也是互相隔离的。</p><p>File System API 提供了一组文件与文件夹的操作接口，有同步和异步两个版本，可满足不同的使用场景。下面通过一个文件创建、读、写的例子，演示下简单的功能与用法。</p><div><div id="highlighter_845525" class="syntaxhighlighter  js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">window.requestFileSystem&nbsp;=&nbsp;window.requestFileSystem&nbsp;||&nbsp;window.webkitRequestFileSystem;</code></div><div class="line number2 index1 alt1"><code class="js comments">//请求临时文件的存储空间</code></div><div class="line number3 index2 alt2"><code class="js keyword">if</code>&nbsp;<code class="js plain">(window.requestFileSystem)&nbsp;{</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">window.requestFileSystem(window.TEMPORARY,&nbsp;5*1024*1024,&nbsp;initFS,&nbsp;errorHandler);</code></div><div class="line number5 index4 alt2"><code class="js plain">}</code><code class="js keyword">else</code><code class="js plain">{</code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">alert(</code><code class="js string">'Sorry!&nbsp;Your&nbsp;browser&nbsp;doesn\'t&nbsp;support&nbsp;the&nbsp;FileSystem&nbsp;API'</code><code class="js plain">);</code></div><div class="line number7 index6 alt2"><code class="js plain">}</code></div><div class="line number8 index7 alt1"><code class="js comments">//请求成功回调</code></div><div class="line number9 index8 alt2"><code class="js keyword">function</code>&nbsp;<code class="js plain">initFS(fs){</code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//在根目录下打开log.txt文件，如果不存在就创建</code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//fs就是成功返回的文件系统对象，fs.root代表根目录</code></div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">fs.root.getFile(</code><code class="js string">'log.txt'</code><code class="js plain">,&nbsp;{create:&nbsp;</code><code class="js keyword">true</code><code class="js plain">},&nbsp;</code><code class="js keyword">function</code><code class="js plain">(fileEntry)&nbsp;{</code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//fileEntry是返回的一个文件对象，代表打开的文件</code></div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//向文件写入指定内容</code></div><div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">writeFile(fileEntry);</code></div><div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//将写入的内容又读出来，显示在页面上</code></div><div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">readFile(fileEntry);</code></div><div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">},&nbsp;errorHandler);</code></div><div class="line number19 index18 alt2"><code class="js plain">}</code></div><div class="line number20 index19 alt1"><code class="js comments">//读取文件内容</code></div><div class="line number21 index20 alt2"><code class="js keyword">function</code>&nbsp;<code class="js plain">readFile(fileEntry)</code></div><div class="line number22 index21 alt1"><code class="js plain">{</code></div><div class="line number23 index22 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">'readFile'</code><code class="js plain">);</code></div><div class="line number24 index23 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js comments">//&nbsp;Get&nbsp;a&nbsp;File&nbsp;object&nbsp;representing&nbsp;the&nbsp;file,</code></div><div class="line number25 index24 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js comments">//&nbsp;then&nbsp;use&nbsp;FileReader&nbsp;to&nbsp;read&nbsp;its&nbsp;contents.</code></div><div class="line number26 index25 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">fileEntry.file(</code><code class="js keyword">function</code><code class="js plain">(file)&nbsp;{</code></div><div class="line number27 index26 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">'createReader'</code><code class="js plain">);</code></div><div class="line number28 index27 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">reader&nbsp;=&nbsp;</code><code class="js keyword">new</code>&nbsp;<code class="js plain">FileReader();</code></div><div class="line number29 index28 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">reader.onloadend&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number30 index29 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">'onloadend'</code><code class="js plain">);</code></div><div class="line number31 index30 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">txtArea&nbsp;=&nbsp;document.createElement(</code><code class="js string">'textarea'</code><code class="js plain">);</code></div><div class="line number32 index31 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">txtArea.value&nbsp;=&nbsp;</code><code class="js keyword">this</code><code class="js plain">.result;</code></div><div class="line number33 index32 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">document.body.appendChild(txtArea);</code></div><div class="line number34 index33 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">};</code></div><div class="line number35 index34 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">reader.readAsText(file);</code></div><div class="line number36 index35 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;</code><code class="js plain">},&nbsp;errorHandler);</code></div><div class="line number37 index36 alt2"><code class="js plain">}</code></div><div class="line number38 index37 alt1"><code class="js comments">//向文件写入指定内容</code></div><div class="line number39 index38 alt2"><code class="js keyword">function</code>&nbsp;<code class="js plain">writeFile(fileEntry)</code></div><div class="line number40 index39 alt1"><code class="js plain">{</code></div><div class="line number41 index40 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">'writeFile'</code><code class="js plain">);</code></div><div class="line number42 index41 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//&nbsp;Create&nbsp;a&nbsp;FileWriter&nbsp;object&nbsp;for&nbsp;our&nbsp;FileEntry&nbsp;(log.txt).</code></div><div class="line number43 index42 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">fileEntry.createWriter(</code><code class="js keyword">function</code><code class="js plain">(fileWriter)&nbsp;{</code></div><div class="line number44 index43 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">'createWriter'</code><code class="js plain">);</code></div><div class="line number45 index44 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">fileWriter.onwriteend&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number46 index45 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">'Write&nbsp;completed'</code><code class="js plain">);</code></div><div class="line number47 index46 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">};</code></div><div class="line number48 index47 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">fileWriter.onerror&nbsp;=&nbsp;</code><code class="js keyword">function</code><code class="js plain">(e)&nbsp;{</code></div><div class="line number49 index48 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">console.log(</code><code class="js string">'Write&nbsp;failed:&nbsp;'</code>&nbsp;<code class="js plain">+&nbsp;e.toString());</code></div><div class="line number50 index49 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">};</code></div><div class="line number51 index50 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;Blob&nbsp;and&nbsp;write&nbsp;it&nbsp;to&nbsp;log.txt.</code></div><div class="line number52 index51 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">blob&nbsp;=&nbsp;</code><code class="js keyword">new</code>&nbsp;<code class="js plain">Blob([</code><code class="js string">'Hello,&nbsp;World!'</code><code class="js plain">],&nbsp;{type:&nbsp;</code><code class="js string">'text/plain'</code><code class="js plain">});</code></div><div class="line number53 index52 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">fileWriter.write(blob);</code></div><div class="line number54 index53 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">},&nbsp;errorHandler);</code></div><div class="line number55 index54 alt2"><code class="js plain">}</code></div><div class="line number56 index55 alt1"><code class="js keyword">function</code>&nbsp;<code class="js plain">errorHandler(err){</code></div><div class="line number57 index56 alt2"><code class="js spaces">&nbsp;</code><code class="js keyword">var</code>&nbsp;<code class="js plain">msg&nbsp;=&nbsp;</code><code class="js string">'An&nbsp;error&nbsp;occured:&nbsp;'</code>&nbsp;<code class="js plain">+&nbsp;err;</code></div><div class="line number58 index57 alt1"><code class="js spaces">&nbsp;</code><code class="js plain">console.log(msg);</code></div><div class="line number59 index58 alt2"><code class="js plain">};</code></div></div></td></tr></tbody></table></div></div><p>将上面代码复制到 file_system_api.html 文件中，用 Google Chrome 浏览器打开（现在 File System API 只有 Chrome 43+、Opera 32+ 以及 Chrome for Android 46+ 这三个浏览器支持）。由于 Google Chrome 禁用了本地 HTML 文件中的 File System API功能，在启动 Chrome 时，要加上”—allow-file-access-from-files“命令行参数。<br></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450238763105052.gif" title="1450238763105052.gif" alt="1MmrSvq.gif" style="width: 388px; height: 101px;"></p><p>上面截图，左边是 HTML 运行的结果，右边是 Chrome 开发者工具中看到的 Web 的文件系统。基本上 H5的几种缓存机制的数据都能在这个开发者工具看到，非常方便。</p><p>分析：File System API 给 Web App 带来了文件系统的功能，Native 文件系统的功能在 Web App 中都有相应的实现。任何需要通过文件来管理数据，或通过文件系统进行数据管理的场景都比较适合。</p><p>到目前，Android 系统的 Webview 还不支持 File System API。</p><p><strong>3 移动端 Web 加载性能（缓存）优化</strong></p><p>分析完 H5提供的各种缓存机制，回到移动端（针对 Android，可能也适用于 iOS）的场景。现在 Android App（包括手 Q 和 WX）大多嵌入了 Webview 的组件（系统 Webview 或 QQ 游览器的 X5组件），通过内嵌Webview 来加载一些H5的运营活动页面或资讯页。这样可充分发挥Web前端的优势：快速开发、发布，灵活上下线。但 Webview 也有一些不可忽视的问题，比较突出的就是加载相对较慢，会相对消耗较多流量。</p><p>通过对一些 H5页面进行调试及抓包发现，每次加载一个 H5页面，都会有较多的请求。除了 HTML 主 URL 自身的请求外，HTML外部引用的 JS、CSS、字体文件、图片都是一个独立的 HTTP 请求，每一个请求都串行的（可能有连接复用）。这么多请求串起来，再加上浏览器解析、渲染的时间，Web 整体的加载时间变得较长；请求文件越多，消耗的流量也会越多。我们可综合使用上面说到几种缓存机制，来帮助我们优化 Web 的加载性能。<br></p><p style="text-align:center"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/1450238866234016.png" title="1450238866234016.png" alt="blob.png" style="width: 380px; height: 195px;"></p><p>结论：综合各种缓存机制比较，对于静态文件，如 JS、CSS、字体、图片等，适合通过浏览器缓存机制来进行缓存，通过缓存文件可大幅提升 Web 的加载速度，且节省流量。但也有一些不足：缓存文件需要首次加载后才会产生；浏览器缓存的存储空间有限，缓存有被清除的可能；缓存的文件没有校验。要解决这些不足，可以参考手 Q 的离线包，它有效的解决了这些不足。</p><p>对于 Web 在本地或服务器获取的数据，可以通过 Dom Storage 和 IndexedDB 进行缓存。也在一定程度上减少和 Server 的交互，提高加载速度，同时节省流量。</p><p>当然 Web 的性能优化，还包括选择合适的图片大小，避免 JS 和 CSS 造成的阻塞等。这就需要 Web 前端的同事根据一些规范和一些调试工具进行优化了。</p>
                </div>
                <div id="page" style="padding:0"></div>

                <div class="wx_article">
                    <div class="article_weixin">
                        <img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/article_weixin.jpg" width="131" height="131" alt="搜索CocoaChina微信公众号：CocoaChina">
                        <div class="article_scan">微信扫一扫</div>
                        <div class="article_txt"><span style="color:#999999">订阅每日移动开发及APP推广热点资讯<br>公众号：</span>CocoaChina</div>
                    </div>
                </div>

               <div class="clearfix tgbox">
                    <a href="http://www.cocoachina.com/deliver.php" class="tg float-l" target="_blank">我要投稿</a>&nbsp;&nbsp;
                    <a style="margin-left:10px" href="javascript:void(0)" onclick="add_favors(14718,&#39;H5 缓存机制浅析 移动端 Web 加载性能优化&#39;)" class="tg float-l">收藏文章</a>
                    <div class="share float-r">分享到：
                        <div class="bdsharebuttonbox" id="sharediv" data-bd-bind="1496720092404"><a href="http://www.cocoachina.com/webapp/20151217/14718.html#" class="bds_more" data-cmd="more"></a> <a href="http://www.cocoachina.com/webapp/20151217/14718.html#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="http://www.cocoachina.com/webapp/20151217/14718.html#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a> <a href="http://www.cocoachina.com/webapp/20151217/14718.html#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
                    </div>
                </div>


                <a class="zanbox" href="javascript:void(0)" id="zanbox" onclick="postDigg(&#39;good&#39;,14718)" title="哎呦，不错噢，赞一个">
                    <strong id="newdigg">
                     <script src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/count(1).php" language="javascript"></script>22
                    </strong>
                </a>
            </div>

            <div class="article-prev">上一篇：<a href="http://www.cocoachina.com/webapp/20151207/14579.html">2015年双11手机淘宝前端技术之H5性能最佳实践</a> </div>
            <div class="article-next">下一篇：<a href="http://www.cocoachina.com/webapp/20151216/14719.html">7 款超具个性的 HTML5 播放器</a> </div>

            <!--相关资讯-->
            <div class="part-wrap clearfix">
                <h3>相关资讯</h3>
                <ul class="info-list clearfix">
                    <li>
                        <a href="http://www.cocoachina.com/webapp/20151216/14719.html" target="_blank" title="这篇文章我们要分享一些很有个性的HTML5音乐播放器和视频播放器，它们都具有播放器的大部分功能，并以HTML5和JavaScript实现。这些HTML5播放器有着非常漂亮的外观，很多你都无需自己重新定义样式，引">7 款超具个性的 HTML5 播放器</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/webapp/20151207/14579.html" target="_blank" title="手淘中大量的业务采用H5的方式开发，H5体验好坏全面影响着手淘的使用体验。今年手机淘宝在技术上重点解“顿”，“卡”，“慢”的问题，并提出了“521法则”。">2015年双11手机淘宝前端技术之H5性能最佳实践</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/webapp/20151202/14546.html" target="_blank" title="Flash不再适应这个年代，这一点Adobe自己也知道。于是他们在2011年就果断宣布放弃移动设备中Flash插件的开发，随后又在同年发布HTML5网页动画工具{AdobeEdge}，依然是2011年，Adobe收购了为HTML5开发者提供跨">Adobe又革了自己一命，Flash Professional CC 将新增 HTML 5 开发工具</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/webapp/20151124/14392.html" target="_blank" title="HTML5和CSS3是一入门就能用的最好的语言，最简单同时也最好的的方式就是直接开始做！那么生成器就在自动生成代码时扮演者重要角色，它们非常适用于那些要做很多重复性工作的开发人员和设计人员">Web开发者推荐的最佳HTML5/CSS3代码生成器</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/webapp/20151116/14223.html" target="_blank" title="现在我们经常会用到一些地图应用，无论是在网页上还是手机App中，地图貌似是一个不可或缺的应用。本文将带领大家一起来看看一些基于jQuery和HTML5的个性化地图插件，有几款地图比较实用，有些则">推荐：7款个性化jQuery/HTML5地图插件</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/webapp/20151105/14070.html" target="_blank" title="作为HTML5新特性之一的WebSocket组件，在实时性有一定要求的WEB应用开发中还是有一定用武之地，高版本的IE、Chrome、FF浏览器都支持Websocket，标准的Websocket通信是基于RFC6455实现服务器端与客户端握手与消">基于Tomcat运行HTML5 WebSocket echo实例详解</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/webapp/20151030/13985.html" target="_blank" title="今天是万维网联盟（W3C）宣布HTML5完成标准制定一周年纪念日，也是互联网和网络程序开发历史上的重要里程碑。过去一年以来，HTML5 得到了迅速普及，越来越多的公司也开始在 HTML5 上为我们开发跨平">HTML5 崛起：不再高冷，不再小众</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/webapp/20151027/13917.html" target="_blank" title="以下是之前学习的一些HTML5 API的总结，在HTML5中有许多功能和接口很值得我们去了解和学习。">HTML5的这些API你知道吗？</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/webapp/20151023/13866.html" target="_blank" title="美国HTML5市场经过5年的长期发展之后，早进入理性的状态，不是炒作概念或者单纯的市场宣讲活动，甚至关注度出现了下降，已经变成了在web技术各个独立领域深度探索和创新。而中国HTML5市场在2015年">中美两国HTML5市场对比 差距在哪里？</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/webapp/20151013/13744.html" target="_blank" title="WeUI是一个类似bootstrap的专门用来开发微信HTML5应用的开源Web UI组件库。它是一套同微信原生视觉体验一致的基础样式库，为微信Web开发量身设计，可以令用户的使用感知更加统一。">WeUI：专为开发微信HTML5应用的开源Web UI组件库</a>
                     </li>

                </ul>
            </div>
            <div class="clearfix" style="margin-top:20px;">
                <script async="" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/adsbygoogle.js.下载"></script>
                <!-- CC评论框 -->
                <ins class="adsbygoogle" style="display:inline-block;width:750px;height:90px" data-ad-client="ca-pub-1180518835303646" data-ad-slot="8242010366"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            <!-- 评论模块start -->
            
            <div class="clearfix" id="commnet_list_holder" style="margin-bottom:50px;">
                <div class="glab-comment-form">
                    <div class="dcbt">我来说两句</div>
                    <div class="user-head">
                        <img id="user_face_url" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/none.gif" height="43" width="43" alt="">
                    </div>
                    <div class="form-region">
                        <textarea name="comment" id="main_comment_content" cols="30" rows="10" placeholder="你怎么看？快来评论一下吧！"></textarea>
                        <a class="submitform" id="main_comment_bt">发表评论</a>
                        <div class="unlogin-mask">
                            <div>您还没有登录！请<a href="http://www.cocoachina.com/bbs/login.php">登录</a>或<a href="http://www.cocoachina.com/bbs/register.php">注册</a></div>
                        </div>
                    </div>
                </div>
                <div id="glab-comment-callback-msg" class="glab-comment-info"></div>
                <div class="glab-comment-title">所有评论（<span>1</span>）</div>
                <div class="glab-commentlist" id="commentlist">
                    <a id="refresh_comment_btn" href="javascript:;" onclick="$(&#39;#morecomment&#39;).trigger(&#39;click&#39;)" style="display: none;">刷新评论</a>
                
    <div class="glab-comment" rel-data-id="20396" rel-user-id="482279" rel-user-name="1806339272" rel-layer="1">
        <div class="comment-left">
            <a href="http://www.cocoachina.com/bbs/u.php?action=feed&amp;uid=482279" target="_blank"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/none.gif" height="43" width="43" alt=""></a>
        </div>
        <div class="comment-right">
            <div class="comment-author"><a href="http://www.cocoachina.com/bbs/u.php?action=feed&amp;uid=482279" target="_blank">1806339272</a><span class="puptime">2016-02-29 02:07:55</span></div>
            <div class="comment-content">h5未来的发展趋势，请问大神如何看待</div>
            <div class="comment-buttons">
                <span class="ding">                    
                    <img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/zan-default.png" height="14" width="14" alt="" class="default" style="">
                    <img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/zan-active.png" height="14" width="14" alt="" class="actived" style=" display:none; ">
                    <span class="zancnt">0</span>
                </span>
                <span class="cai">
                    <img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/cai-default.png" height="14" width="14" alt="" class="default" style="">
                    <img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/cai-active.png" height="14" width="14" alt="" class="actived" style=" display:none; ">
                    <span class="zancnt">0</span>
                </span>
                <span class="replybt">回复</span>
            </div>
        </div>
    </div>  
</div>
                <div class="glab-comment-more" id="morecomment" style="display:none">
                    更多评论
                </div>
            </div>
            
            <!-- 评论模块end -->


        </div>
        <!--./left-->
        <!--侧边栏-->
        <div class="clearfix newslist">
            <div class="rightSide detail-right float-r">
                <!--两周热门资讯推荐-->
                <div>
                    <div class="part-wrap clearfix">
                        <h3>热门资讯</h3>
                        <ul class="related-hot">
                            <li class="clearfix"><a href="http://www.cocoachina.com/ios/20170519/19320.html" class="float-l pic" target="_blank" title="iOS学院福利大放送 进阶课程免费领"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/0f6bee3e695e50c16c42a9fa7e056a02.jpg" style="max-height:60px" alt="iOS学院福利大放送 进阶课程免费领"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20170519/19320.html" target="_blank" title="iOS学院福利大放送 进阶课程免费领">iOS学院福利大放送 进阶课程免费领</a></p><p class="hits">点击量<span>5620</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/programmer/20170518/19307.html" class="float-l pic" target="_blank" title="华为恐惧症？ 一名40岁“老”程序员的反思"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/e3b0b612da31911f2ba84022b738ef77.png" style="max-height:60px" alt="华为恐惧症？ 一名40岁“老”程序员的反思"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/programmer/20170518/19307.html" target="_blank" title="华为恐惧症？ 一名40岁“老”程序员的反思">华为恐惧症？ 一名40岁“老”程序员的反思</a></p><p class="hits">点击量<span>3615</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/android/20170519/19311.html" class="float-l pic" target="_blank" title="为什么我要改用Kotlin"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/def3e7d1f4f0cb94a8e50264a8ef70d1.jpg" style="max-height:60px" alt="为什么我要改用Kotlin"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/android/20170519/19311.html" target="_blank" title="为什么我要改用Kotlin">为什么我要改用Kotlin</a></p><p class="hits">点击量<span>3485</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/programmer/20170519/19310.html" class="float-l pic" target="_blank" title="一位五年工作经验架构师的感悟"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/93d453bdde89ec9bbe8a4f7d72ec84d4.jpg" style="max-height:60px" alt="一位五年工作经验架构师的感悟"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/programmer/20170519/19310.html" target="_blank" title="一位五年工作经验架构师的感悟">一位五年工作经验架构师的感悟</a></p><p class="hits">点击量<span>3447</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/industry/20170522/19330.html" class="float-l pic" target="_blank" title="我实在想看看苹果到底敢不敢下架微信"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/914a287531d6a3c5d5b9ffa1767784c4.jpg" style="max-height:60px" alt="我实在想看看苹果到底敢不敢下架微信"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/industry/20170522/19330.html" target="_blank" title="我实在想看看苹果到底敢不敢下架微信">我实在想看看苹果到底敢不敢下架微信</a></p><p class="hits">点击量<span>3270</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/ios/20170522/19333.html" class="float-l pic" target="_blank" title="Swift 再等等？我的答案是：快上车"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/0eab86b056fc76a2de46b06daf6b31e8.jpg" style="max-height:60px" alt="Swift 再等等？我的答案是：快上车"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20170522/19333.html" target="_blank" title="Swift 再等等？我的答案是：快上车">Swift 再等等？我的答案是：快上车</a></p><p class="hits">点击量<span>2995</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/ios/20170522/19322.html" class="float-l pic" target="_blank" title="写给广大非科班iOS开发者的一篇面试总结 — 先是程序员，然后才是iOS程序员"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/68a6f4133676b19e7792e9b5319645e1.jpg" style="max-height:60px" alt="写给广大非科班iOS开发者的一篇面试总结 — 先是程序员，然后才是iOS程序员"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20170522/19322.html" target="_blank" title="写给广大非科班iOS开发者的一篇面试总结 — 先是程序员，然后才是iOS程序员">写给广大非科班iOS开发者的一篇面试总结 — 先是程序员，然后才是iOS程序员</a></p><p class="hits">点击量<span>2947</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/ios/20170519/19317.html" class="float-l pic" target="_blank" title="iOS中使用Fastlane实现自动化打包和发布"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/9a61b67221524a5213188ee0061497ec.jpg" style="max-height:60px" alt="iOS中使用Fastlane实现自动化打包和发布"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20170519/19317.html" target="_blank" title="iOS中使用Fastlane实现自动化打包和发布">iOS中使用Fastlane实现自动化打包和发布</a></p><p class="hits">点击量<span>2795</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/apple/20170518/19302.html" class="float-l pic" target="_blank" title="“用完就走”的微信，正变得让人“用了就走不了”"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/64ba3e90dbcbc86c8749e6ecf3d578fc.jpg" style="max-height:60px" alt="“用完就走”的微信，正变得让人“用了就走不了”"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/apple/20170518/19302.html" target="_blank" title="“用完就走”的微信，正变得让人“用了就走不了”">“用完就走”的微信，正变得让人“用了就走不了”</a></p><p class="hits">点击量<span>2745</span></p></div></li><li class="clearfix noborder-b"><a href="http://www.cocoachina.com/programmer/20170519/19319.html" class="float-l pic" target="_blank" title="一个老码农的技术理想"><img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/c22c7905f63eac47dccbc94c6b8af561.png" style="max-height:60px" alt="一个老码农的技术理想"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/programmer/20170519/19319.html" target="_blank" title="一个老码农的技术理想">一个老码农的技术理想</a></p><p class="hits">点击量<span>2607</span></p></div></li>
                        </ul>
                    </div>
               </div>
               <!--./两周热门资讯推荐-->
               <!--综合评论-->
                <div class="part-wrap clearfix" style="margin-top: 15px;">
                    <h3>综合评论</h3>
                    <ul class="related-comment clearfix" id="all_comments_holder"><li class=""><span class="hide_comment">我居然只用过第八个，我可能开发的是安卓</span><br><p><span>太阳当空照花儿对我笑</span><span>评论了</span><a target="_blank" title="10个你必须知道的ios框架" href="http://www.cocoachina.com/ios/20170602/19421.html"><span>10个你必须知道的ios框架...</span></a></p></li><li class=""><span class="hide_comment">看看这个优秀团队博客http://wereadteam.github.io/2017/03/13/Signature/</span><br><p><span>lalalalall</span><span>评论了</span><a target="_blank" title="iOS App 签名的原理" href="http://www.cocoachina.com/ios/20170602/19427.html"><span>iOS App 签名的原理</span></a></p></li><li class=""><span class="hide_comment">苹果公司高级副总裁Craig&nbsp;Federighi介绍，目前用户对iOS系统的满意度达到了96%。瞎扯蛋，</span><br><p><span>yanggege</span><span>评论了</span><a target="_blank" title="iOS 11亮点：Apple Pay可转账 中国版可识别诈骗短信" href="http://www.cocoachina.com/industry/20170606/19445.html"><span>iOS 11亮点：Apple Pay可转账 中国版...</span></a></p></li><li class=""><span class="hide_comment">没答案弄个毛啊</span><br><p><span>iOS谷晋华</span><span>评论了</span><a target="_blank" title="据说这份考卷，98%的程序员都得不到满分！" href="http://www.cocoachina.com/programmer/20170605/19442.html"><span>据说这份考卷，98%的程序员都得不到满分！...</span></a></p></li><li class=""><span class="hide_comment">?????????????????<br><br>2017-06-09&nbsp;12:41&nbsp;编辑：&nbsp;suiling&nbsp;分类：专题频道&nbsp;来源：</span><br><p><span>feike2011</span><span>评论了</span><a target="_blank" title="你对苹果 WWDC 2017 有何期待？" href="http://www.cocoachina.com/special/20170605/19436.html"><span>你对苹果 WWDC 2017 有何期待？...</span></a></p></li><li class=""><span class="hide_comment">这个文章发表过一次吧？<br>额。。。</span><br><p><span>zengjun1987a</span><span>评论了</span><a target="_blank" title="哪些人不适合当程序员？" href="http://www.cocoachina.com/programmer/20170605/19440.html"><span>哪些人不适合当程序员？...</span></a></p></li><li class=""><span class="hide_comment">到底是谁脑子坏了？&nbsp;</span><br><p><span>zengjun1987a</span><span>评论了</span><a target="_blank" title="几个使用iPhone的坏习惯，最后一个大部分人都有" href="http://www.cocoachina.com/apple/20170605/19439.html"><span>几个使用iPhone的坏习惯，最后一个大部分人都有...</span></a></p></li><li class=""><span class="hide_comment">标题党</span><br><p><span>太阳当空照花儿对我笑</span><span>评论了</span><a target="_blank" title="几个使用iPhone的坏习惯，最后一个大部分人都有" href="http://www.cocoachina.com/apple/20170605/19439.html"><span>几个使用iPhone的坏习惯，最后一个大部分人都有...</span></a></p></li><li class=""><span class="hide_comment">花架子文章！看了前面几段，果断打住！</span><br><p><span>itwyhuaing</span><span>评论了</span><a target="_blank" title="程序员为什么会忧虑自己的未来?" href="http://www.cocoachina.com/programmer/20170605/19432.html"><span>程序员为什么会忧虑自己的未来?...</span></a></p></li><li class="noborder-b"><span class="hide_comment">最早的二进制思想不是八卦图？</span><br><p><span>dearxiaomu</span><span>评论了</span><a target="_blank" title="据说这份考卷，98%的程序员都得不到满分！" href="http://www.cocoachina.com/programmer/20170605/19442.html"><span>据说这份考卷，98%的程序员都得不到满分！...</span></a></p></li></ul>
                </div>
                <!--./综合评论-->
                <!--相关帖子-->
                <div class="part-wrap clearfix" style="margin:15px 0 15px 0;">
                    <h3>相关帖子</h3>
                    <ul class="related-comment clearfix">
                        <script charset="gb2312" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/new.php"></script><li><a href="http://www.cocoachina.com/bbs/read.php?tid=1721028" target="_blank">开发者很多要求又变了，iOS11 苹果iOS11系统什么时候发布?</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=1721027" target="_blank">CGBitmapContextCreate: unsupported parameter combination:。。大神快进来，急急急</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=1721026" target="_blank">qq第三方登录时登录不上</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=1721025" target="_blank">iOS Label上的文字自适应Label的宽高?</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=1721024" target="_blank">IDEA.StatiCa.v8.0.16.43607结构软件</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=1721023" target="_blank">Promotional Text促销文字</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=1721021" target="_blank">tableviewcell上放collectionView</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=1721019" target="_blank">求助大神计时器</a></li><li class="clearfix noborder-b"><a href="http://www.cocoachina.com/bbs/read.php?tid=1721018" target="_blank">app store 的应用下架，这个下架的应用名称 多久后才可以使用？</a></li>
                    </ul>
                </div>
                <!--./相关帖子-->
                <iframe width="230" height="550" class="share_self" frameborder="0" scrolling="no" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/index.html"></iframe>
                <script async="" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/adsbygoogle.js.下载"></script>
                <!-- CC列表页面230x230 -->
                <ins class="adsbygoogle" style="display:inline-block;width:230px;height:230px" data-ad-client="ca-pub-1180518835303646" data-ad-slot="6765277166"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>
        <!--./侧边栏-->
    </div>

    <div id="coco-store" style="display:none">
        <div class="storebox">
            <h5>提示</h5>
            <h3>已经收藏该篇文章</h3>
            <p class="p1"><a href="http://www.cocoachina.com/bbs/u.php?action=favor&amp;tag=1" target="_blank">去我的收藏夹</a></p>
            <p class="p2"><a href="http://www.cocoachina.com/bbs/login.php">请登录</a></p>
        </div>
    </div> <!--收藏提示-->
</div>

<script type="text/javascript">

function postDigg(ftype,aid)
{
    var taget_obj = document.getElementById('newdigg');
    var saveid = GetCookie('diggid');
    if(saveid != null)
    {
        var saveids = saveid.split(',');
        var hasid = false;
        saveid = '';
        j = 1;
        for(i=saveids.length-1;i>=0;i--)
        {
            if(saveids[i]==aid && hasid) continue;
            else {
                if(saveids[i]==aid && !hasid) hasid = true;
                saveid += (saveid=='' ? saveids[i] : ','+saveids[i]);
                j++;
                if(j==20 && hasid) break;
                if(j==19 && !hasid) break;
            }
        }
        if(hasid) { alert("您已经顶过该帖，请不要重复顶帖 ！"); return; }
        else saveid += ','+aid;
        SetCookie('diggid',saveid,1);
    }
    else
    {
        SetCookie('diggid',aid,1);
    }
    myajax = new DedeAjax(taget_obj,false,false,'','','');
    var url = "/cms/plus/digg_ajax.php?action="+ftype+"&id="+aid;
    myajax.SendGet2(url);
    DedeXHTTP = null;
    $('#zanbox').addClass('zanbox-selected');
}
function getDigg(aid)
{
    var taget_obj = document.getElementById('newdigg');
    myajax = new DedeAjax(taget_obj,false,false,'','','');
    myajax.SendGet2("/cms/plus/digg_ajax.php?id="+aid);
    DedeXHTTP = null;
}


//显示对应的导航：
$(function(){
    var article_id = $('#article_id').val();
    var saveid = GetCookie('diggid');

    if(saveid != null)
    {
        var saveids = saveid.split(',');
        var hasid = false;
        saveid = '';
        j = 1;
        for(i=saveids.length-1;i>=0;i--)
        {
            if(saveids[i]==article_id && hasid) continue;
            else {
                if(saveids[i]==article_id && !hasid) hasid = true;
                saveid += (saveid=='' ? saveids[i] : ','+saveids[i]);
                j++;
                if(j==20 && hasid) break;
                if(j==19 && !hasid) break;
            }
        }

        if(hasid)
        {
            $('#zanbox').addClass('zanbox-selected');
        }

    }

});

window.onload = function() {

    $('#sharediv').removeClass('bdshare-button-style1-32');
    $('#sharediv').attr('class','bdsharebuttonbox');
};
</script>
<script type="text/javascript" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/shCore.js.下载"></script>
    <script type="text/javascript" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/brush.js.下载"></script>
    <link type="text/css" rel="stylesheet" href="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/shCoreDefault.css">
    <script type="text/javascript">
    //SyntaxHighlighter.config.clipboardSwf = '/js/scripts/clipboard.swf';

    SyntaxHighlighter.all();</script>


<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"H5 缓存机制浅析 移动端 Web 加载性能优化 - 来自CocoaChina苹果开发中文站@CocoaChina","bdMini":"2","bdMiniList":false,"bdPic":"http://api.cocoachina.com/uploads/151216/e8526c491daa8ca2630d79166ee1ef3c.png","bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api//js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<!--./cont-->

<!-- 回复评论框模板 -->
<script type="text/javascript" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/comment.js.下载"></script>
<script type="text/javascript" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/mustache.min.js.下载"></script>
<!-- 回复评论框模板 -->
<script id="reply_comment_template" type="x-tmpl-mustache">
    <div id="sub-reply-comment" class="reply-comment">
        <textarea name="subcomment" id="sub-reply-txt" cols="30" rows="10" placeholder="你怎么看？快来评论一下吧！"></textarea>
        <input type="hidden" id="sub-reply-id" value="{{commentid}}" />
        <input type="hidden" id="sub-reply-userid" value="{{parentuserid}}" />
        <input type="hidden" id="sub-reply-username" value="{{parentusername}}" />
        <a type="button" id="sub_comment_bt" class="submitbt">提交</a>
        <div class="clearfloat"></div>
        <div class="unlogin-mask">
            <div>您还没有登录！请<a href="/bbs/login.php">登录</a>或<a href="/bbs/register.php">注册</a></div>
        </div>
    </div>
</script>

<!-- 评论模板 -->
<script id="main_comment_template" type="x-tmpl-mustache">
    <div class="glab-comment" rel-data-id="{{comment_id}}" rel-user-id="{{user_id}}" rel-user-name="{{user_name}}" rel-layer="1">
        <div class="comment-left">
            <a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank"><img src="{{user_icon_url}}" height="43" width="43" alt=""></a>
        </div>
        <div class="comment-right">
            <div class="comment-author"><a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank">{{user_name}}</a><span class="puptime">{{create_time}}</span></div>
            <div class="comment-content">{{&content}}</div>
            <div class="comment-buttons">
                <span class="ding">                    
                    <img src="http://cdn.cocimg.com/cms/templets/images/zan-default.png" height="14" width="14" alt="" class="default" style="{{#has_supported}} display:none; {{/has_supported}}">
                    <img src="http://cdn.cocimg.com/cms/templets/images/zan-active.png" height="14" width="14" alt="" class="actived" style="{{^has_supported}} display:none; {{/has_supported}}">
                    <span class="zancnt">{{support}}</span>
                </span>
                <span class="cai">
                    <img src="http://cdn.cocimg.com/cms/templets/images/cai-default.png" height="14" width="14" alt="" class="default" style="{{#has_reported}} display:none; {{/has_reported}}">
                    <img src="http://cdn.cocimg.com/cms/templets/images/cai-active.png" height="14" width="14" alt="" class="actived" style="{{^has_reported}} display:none; {{/has_reported}}">
                    <span class="zancnt">{{report}}</span>
                </span>
                <span class="replybt">回复</span>
            </div>
        </div>
            {{#sub}}
                <div class="glab-comment glab-sub-comment" rel-data-id="{{comment_id}}" rel-user-id="{{user_id}}" rel-user-name="{{user_name}}" rel-layer="2">
                    <div class="comment-left">
                        <a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank"><img src="{{user_icon_url}}" height="43" width="43" alt=""></a>
                    </div>
                    <div class="comment-right">
                        <div class="comment-author"><a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank">{{user_name}}</a><span class="puptime">{{create_time}}</span></div>
                        <div class="comment-content"><a href="/bbs/u.php?action=feed&uid={{parent_user_id}}" target="_blank">回复：{{parent}}</a>{{&content}}</div>
                        <div class="comment-buttons">
                            <span class="ding">
                                <img src="http://cdn.cocimg.com/cms/templets/images/zan-default.png" height="14" width="14" alt="" class="default" style="{{#has_supported}} display:none; {{/has_supported}}">
                                <img src="http://cdn.cocimg.com/cms/templets/images/zan-active.png" height="14" width="14" alt="" class="actived" style="{{^has_supported}} display:none; {{/has_supported}}">
                                <span class="zancnt">{{support}}</span>
                            </span>
                            <span class="cai">
                                <img src="http://cdn.cocimg.com/cms/templets/images/cai-default.png" height="14" width="14" alt="" class="default" style="{{#has_reported}} display:none; {{/has_reported}}">
                                <img src="http://cdn.cocimg.com/cms/templets/images/cai-active.png" height="14" width="14" alt="" class="actived" style="{{^has_reported}} display:none; {{/has_reported}}">
                                <span class="zancnt">{{report}}</span>
                            </span>
                            <span class="replybt">回复</span>
                        </div>          
                    </div>
                </div>
            {{/sub}}         
    </div>  
</script>


<script id="sub_comment_template" type="x-tmpl-mustache">
    <div class="glab-comment glab-sub-comment" rel-data-id="{{comment_id}}" rel-user-id="{{user_id}}" rel-user-name="{{user_name}}" rel-layer="2">
        <div class="comment-left">
            <a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank"><img src="{{user_icon_url}}" height="43" width="43" alt=""></a>
        </div>
        <div class="comment-right">
            <div class="comment-author"><a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank">{{user_name}}</a><span class="puptime">{{create_time}}</span></div>
            <div class="comment-content"><a href="/bbs/u.php?action=feed&uid={{parent_user_id}}" target="_blank">回复：{{parent}}</a>{{&content}}</div>
            <div class="comment-buttons">
                <span class="ding">
                    <img src="http://cdn.cocimg.com/cms/templets/images/zan-default.png" height="14" width="14" alt="" class="default" style="{{#has_supported}} display:none; {{/has_supported}}">
                    <img src="http://cdn.cocimg.com/cms/templets/images/zan-active.png" height="14" width="14" alt="" class="actived" style="{{^has_supported}} display:none; {{/has_supported}}">
                    <span class="zancnt">{{support}}</span>
                </span>
                <span class="cai">
                    <img src="http://cdn.cocimg.com/cms/templets/images/cai-default.png" height="14" width="14" alt="" class="default" style="{{#has_reported}} display:none; {{/has_reported}}">
                    <img src="http://cdn.cocimg.com/cms/templets/images/cai-active.png" height="14" width="14" alt="" class="actived" style="{{^has_reported}} display:none; {{/has_reported}}">
                    <span class="zancnt">{{report}}</span>
                </span>
                <span class="replybt">回复</span>
            </div>          
        </div>
    </div>
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68948817-1', 'auto', {'name': 'newTracker'});
  ga('newTracker.send', 'pageview');

</script>
    
<!--右侧浮动-->
    <div class="r-bar" style="position: fixed; top: inherit; bottom: 10px;">
        <img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/coco_weixin.png" class="weixin">
    	<a href="http://weibo.com/cocoachina" target="_blank" title="" class="weibo">sina</a>
        <a href="javascript:void(0);" target="_blank" title="" class="feedback">weixin</a>
        <a href="mailto:support@cocoachina.com" title="" class="kefu">mail</a>
        <a href="javascript:;" title="回到顶部" class="returntop" style="display: inline;">回到顶部</a>
    </div>

<script language="javascript" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/bbsauth_plus2015.php" type="text/javascript"></script>
<script type="text/javascript">
$(function(){
    if (typeof(_user_info_html) != 'undefined' && _user_info_html)
    {
        $('.nav-user-login').hide();
        $('.nav-user-name').html(_user_info_html).show();
    }

	var type = $('#type_name').html();
	if(type)
	{	
		switch( type )
		{
			case 'iOS开发':
				$('#ios').addClass('light');
				break;
			case 'AppStore研究':
				$('#app_store').addClass('light');
				break;
			case 'Mac开发':
				$('#mac').addClass('light');
				break;
			case '产品设计':
				$('#design').addClass('light');
				break;
			case 'Cocos引擎':
				$('#cocos').addClass('light');
				break;
			case 'WebApp':
				$('#webapp').addClass('light');
				break;
			case 'Swift':
				$('#swift').addClass('light');
				break;
			case '游戏开发':
				$('#game').addClass('light');
				break;
			case '苹果相关':
				$('#apple').addClass('light');
				break;
			case '营销推广':
				$('#market').addClass('light');
				break;		
			case '业界动态':
				$('#industry').addClass('light');
				break;	
			case '程序人生':
				$('#programmer').addClass('light');
				break;																																
				
		}
	}
});
</script>
<!--./cont-->
<script type="text/javascript" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/index.js.下载"></script>
<script src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/jquery.colorbox-min.js.下载" type="text/javascript"></script>
<script src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/script.js.下载" type="text/javascript"></script>
<script type="text/javascript">
			jQuery(function()
			{
				//更改文章来源
				var source = $('#source a').html();								
				if( source == '未知' )
					jQuery('#source a').html('CocoaChina');
				if( jQuery('#source a').attr('href')=='')
					jQuery('#source').html('来源：'+source);
				
				//获取用户登录的id
//                var content = jQuery('.t-lid').attr("href");
//                var uid = 0;
//                if( content )
//                {
//                    content = content.split('=');
//                    uid = content[1];
//                }
//                var timestamp = new Date().getTime();	
//                var uid2 = parseInt(uid);
//                if(uid2==uid && uid2!=0){
//                    uid = uid<<2;			
//                    uid = uid+''+timestamp;
//                }else{
//                    uid = "";
//                }
//                var oIframe=document.getElementById("comiframe");
//                if(oIframe){
//                    var oUrl=window.location.href;
//                    oUrl = encodeURIComponent(oUrl);
//
//                    oIframe.src="/comment.php?url="+oUrl+"&uid="+uid;
//                }

				
			});
		</script>
<!--footer-->
<div class="footer clearfix">
    <div class="footer-b">
        <div>
            <a href="http://www.cocoachina.com/aboutus/index.html" target="_blank">关于我们</a>
            <a href="http://www.cocoachina.com/contactus/index.html" target="_blank">商务合作</a>
            <a href="mailto:support@cocoachina.com" target="_blank">联系我们</a>
            <a href="http://www.cocoachina.com/corps" target="_blank">合作伙伴</a>
        </div>
        <p class="footer-b-p">北京触控科技有限公司版权所有</p>
        <p>
            ©2016 Chukong Technologies,Inc.
            <i>
                <a href="http://www.miibeian.gov.cn/" target="_blank">京ICP备 11006519号 　京ICP证 100954号</a> 京公网安备11010502020289 
                <a href="http://182.131.21.137/ccnt-apply/admin/business/preview/business-preview!lookUrlRFID.action?main_id=A580B24B1AE846CE9DA949026D63939F" target="_blank">
                    <img src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/jingwen.png" style="margin: -10px auto -14px -10px;">
                    京网文[2012]0426-138号
                </a>
            </i>
        </p>
    </div>
</div>
<!--./footer-->
<script language="javascript" type="text/javascript" src="./H5 缓存机制浅析 移动端 Web 加载性能优化 - CocoaChina_让移动开发更简单_files/dedeajax2-min.js.下载"></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?88399e4c4cf744609c4fc8c3a8935691";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-16940817-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  
 
function search_check()
{
	var search_keyword = $('#search_keyword').val();

	if( search_keyword.length < 2 )
	{
		alert("搜索关键字不能少于2个字节，请重新输入。");
	}
	else
	{
		$('#searchform').submit();
	}
}

</script>
<script type="text/javascript">
_acK({aid:116313,format:0,mode:1,gid:1,serverbaseurl:"afp.csbew.com/"});
</script>



<div id="cboxOverlay" style="display: none;"></div><div id="colorbox" class="" style="display: none;"><div id="cboxWrapper"><div><div id="cboxTopLeft" style="float: left;"></div><div id="cboxTopCenter" style="float: left;"></div><div id="cboxTopRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxMiddleLeft" style="float: left;"></div><div id="cboxContent" style="float: left;"><div id="cboxLoadedContent" style="width: 0px; height: 0px; overflow: hidden; float: left;"></div><div id="cboxLoadingOverlay" style="float: left;"></div><div id="cboxLoadingGraphic" style="float: left;"></div><div id="cboxTitle" style="float: left;"></div><div id="cboxCurrent" style="float: left;"></div><div id="cboxNext" style="float: left;"></div><div id="cboxPrevious" style="float: left;"></div><div id="cboxSlideshow" style="float: left;"></div><div id="cboxClose" style="float: left;"></div></div><div id="cboxMiddleRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxBottomLeft" style="float: left;"></div><div id="cboxBottomCenter" style="float: left;"></div><div id="cboxBottomRight" style="float: left;"></div></div></div><div style="position: absolute; width: 9999px; visibility: hidden; display: none;"></div></div></body></html>